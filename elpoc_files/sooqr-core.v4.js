websight.sooqr.Debug={containerElement:void 0,log:function(message){if(void 0==message)return!1;if(void 0==this.containerElement){this.containerElement=document.createElement("div"),this.containerElement.id="LogWindow",this.containerElement.style.position="absolute",this.containerElement.style.zIndex="10000",this.containerElement.style.top="45px",this.containerElement.style.left="100%",this.containerElement.style.marginLeft="-315px",this.containerElement.style.backgroundColor="#F7F7F7",this.containerElement.style.border="1px solid #DDDDDD",this.containerElement.style.width="300px",this.containerElement.style.padding="5px",document.body.appendChild(this.containerElement);var headerElement=document.createElement("h3");headerElement.style.margin="5px 0px",headerElement.style.fontSize="16px",headerElement.appendChild(document.createTextNode("Debug")),this.containerElement.appendChild(headerElement)}message.toSource&&(message=message.toSource());var messageElement=document.createElement("div");messageElement.appendChild(document.createTextNode(message)),this.containerElement.appendChild(messageElement),this.containerElement.appendChild(document.createElement("HR"))}},function($){$.fn.listHandlers=function(events,outputFunction){return this.each(function(i){var elem=this,dEvents=$(this).data("events");dEvents&&$.each(dEvents,function(name,handler){new RegExp("^("+("*"===events?".+":events.replace(",","|").replace(/^on/i,""))+")$","i").test(name)&&$.each(handler,function(i,handler){outputFunction(elem,"\n"+i+": ["+name+"] : "+handler)})})})}}($jQ),wsDebug=websight.sooqr.Debug.log,websight.sooqr.FilterPanel=function(controllerInstance,parameters,filterQuery){this.controllerInstance=controllerInstance,this.objectName="FilterPanel",this.defaultFilters=this.controllerInstance.parameters.defaultFilters||{},this.defaultSubValues=this.controllerInstance.parameters.defaultSubValues||{},this.parameters=parameters,this.structure=parameters.filters,this.panelElement=$jQ("div.sooqrSearchFilters",controllerInstance.getFilterContainer()),this.formElement=$jQ('<form method="get" action="#"/>'),this.isFilterpanelFixed=!1,this.filterGroupCache={},this.persistentParameters={filtersShowAll:!1,filterValuesShowAll:{}},this.filterContainers={},this.lastInitializedParameters={},this.handleLocationInputTimeout=null,this.lastFilterQuery=filterQuery,this.toArray=function(){var jsonValues={},formValues=this.formElement.serializeArray();for(iValue=0;iValue<formValues.length;iValue++){var filterName=formValues[iValue].name.substring(12);if("[]"==filterName.substring(filterName.length-2)){var filterName=filterName.substring(0,filterName.length-2);filterName in jsonValues||(jsonValues[filterName]=new Array),jsonValues[filterName]instanceof Array?jsonValues[filterName].push(formValues[iValue].value):("values"in jsonValues[filterName]||(jsonValues[filterName].values=new Array),jsonValues[filterName].values.push(formValues[iValue].value))}else if("[_]"==filterName.substring(filterName.length-3)){var filterName=filterName.substring(0,filterName.length-3);filterName in jsonValues||(jsonValues[filterName]={}),jsonValues[filterName]._=formValues[iValue].value}else{var matches;null!==(matches=filterName.match(/^(.+)\[(.+)\]$/))?(matches[1]in jsonValues||(jsonValues[matches[1]]={}),jsonValues[matches[1]][matches[2]]=formValues[iValue].value):jsonValues[filterName]=formValues[iValue].value}}for(k in this.structure)if(this.structure.hasOwnProperty(k)){var fieldData=this.structure[k];switch(fieldData.type){case"radiotree":jsonValues[fieldData.id]._&&!jsonValues[fieldData.id].values&&this.defaultSubValues[fieldData.id]&&this.defaultSubValues[fieldData.id][jsonValues[fieldData.id]._]&&(jsonValues[fieldData.id].values=[this.defaultSubValues[fieldData.id][jsonValues[fieldData.id]._]]);break;case"slider":break;case"dualslider":var slider=$jQ('div.searchFilter[data-filter-id="'+fieldData.id+'"] div.searchFilterField div.searchFilterSlider',this.panelElement);if(slider.length){var sliderValues=slider.slider("option","values");slider.slider("option","min")==sliderValues[0]&&slider.slider("option","max")==sliderValues[1]||(jsonValues[fieldData.id]={left:slider.slider("option","min"),min:sliderValues[0],max:sliderValues[1],right:slider.slider("option","max")})}}}return 0==jsonValues.length&&(jsonValues=null),this.lastFilterQuery=jsonValues,jsonValues},this.updateRangeSliderMin=function(searchFilter,filterIndex,ui){filterIndex in this.lastInitializedParameters.filters&&this.lastInitializedParameters.filters[filterIndex].zeroLabel&&0==ui.values[0]?$jQ("div.searchFilterSliderLegendMin",searchFilter).text(this.lastInitializedParameters.filters[filterIndex].zeroLabel):$jQ("div.searchFilterSliderLegendMin",searchFilter).text(ui.values[0])},this.updateRangeSliderMax=function(searchFilter,filterIndex,ui){filterIndex in this.lastInitializedParameters.filters&&this.lastInitializedParameters.filters[filterIndex].zeroLabel&&0==ui.values[1]?$jQ("div.searchFilterSliderLegendMax",searchFilter).text(this.lastInitializedParameters.filters[filterIndex].zeroLabel):filterIndex in this.lastInitializedParameters.filters&&this.lastInitializedParameters.filters[filterIndex].maxLabel&&ui.values[1]==this.lastInitializedParameters.filters[filterIndex].max?$jQ("div.searchFilterSliderLegendMax",searchFilter).text(this.lastInitializedParameters.filters[filterIndex].maxLabel):$jQ("div.searchFilterSliderLegendMax",searchFilter).text(ui.values[1])},this.updateRangeSlider=function(searchFilter,filterIndex,ui){this.updateRangeSliderMin(searchFilter,filterIndex,ui),this.updateRangeSliderMax(searchFilter,filterIndex,ui)},this.handleRangleSlider=function(event,ui){var searchFilter=$jQ(ui.handle).closest("div.searchFilterField"),filterId=searchFilter.attr("rel");if(ui.values[0]==ui.values[1])return!1;this.updateRangeSlider(searchFilter,filterId,ui),searchFilter.addClass("active");var handles=$jQ("a.ui-slider-handle",searchFilter);for(iHandle=0;iHandle<handles.length;iHandle++){var handleLeftOffset=$jQ(handles[iHandle]).css("left");0==iHandle?$jQ("div.searchFilterSliderLegendMin",searchFilter).css("left",handleLeftOffset):$jQ("div.searchFilterSliderLegendMax",searchFilter).css("left",handleLeftOffset)}},this.handleChangedFilterById=function(filterId){additionalParameters={filterInitiated:!0,triggerFilter:filterId},this.controllerInstance.searchCallback.directCallback(additionalParameters),this.panelElement.find('a[rel="reset"]').css("visibility","visible"),$jQ(this.controllerInstance).trigger("filterChanged",[])},this.handleChangedFilter=function(event){var filterId=$jQ(event.target).closest("div.searchFilter").data("filter-id");if("radio"==event.target.type||"radiotree"==event.target.type){var jQTarget=$jQ(event.target);if(0==jQTarget.closest("div.searchFilterFieldTreeSubvalues").length){var matches=event.target.name.match(/searchFilter([0-9]+)/);if(matches){var filterId=matches[1];$jQ("div.searchFilterFieldTreeSubvalues","#sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+filterId).remove()}}for(var filterFields=$jQ("div.searchFilterField",$jQ(event.target).closest("div.searchFilterValues")).not(jQTarget.parents()),radioInputs=$jQ('input[type="radio"]',filterFields),iInput=0;iInput<radioInputs.length;iInput++)radioInputs.eq(iInput).siblings().removeClass("active")}$jQ(event.target).siblings().length>0?$jQ(event.target).siblings().toggleClass("active"):$jQ(event.target).closest(".searchFilterField ").find('label, span[rel="results"]').toggleClass("active"),this.handleChangedFilterById(filterId)},this.handleQueryFilter=function(event){var labels=$jQ(event.target).siblings("label");labels.length&&this.controllerInstance.setQueryText(labels.first().text()),event.preventDefault()},this.showAllFilters=function(){return this.persistentParameters.filtersShowAll=!0,additionalParameters={filterInitiated:!0,enableFiltersShowAll:!0},this.controllerInstance.searchCallback.directCallback(additionalParameters),!1},this.toggleAllFilterValues=function(event,state){if(event.stopPropagation(),event.preventDefault(),event.currentTarget.rel){var filterId=event.currentTarget.rel;state?this.persistentParameters.filterValuesShowAll[filterId]=!0:delete this.persistentParameters.filterValuesShowAll[filterId],additionalParameters={filterInitiated:!0},this.controllerInstance.searchCallback.directCallback(additionalParameters)}return!1},this.showAllFilterValues=function(event){return this.toggleAllFilterValues(event,!0)},this.hideAllFilterValues=function(event){return this.toggleAllFilterValues(event,!1)},this.disableOtherSelects=function(){var searchFilter=$jQ(this).closest("div.searchFilter");searchFilter.hasClass("disabled")||(searchFilters=$jQ('div.searchFilterField input[type = "checkbox"]',searchFilter).not(this).prop("checked",!1),$jQ(searchFilters).siblings().removeClass("active"))},this.togglePanel=function(state){this.panelElement.css("visibility",state?"visible":"hidden"),0==state&&(this.filterGroupCache={})},this.updateFilters=function(parameters,queryParameters){for(var initFilters=0,hasActiveFilterOptions=!1,newFilters=[],iFilter=0;iFilter<parameters.filters.length;iFilter++)newFilters.push(parseInt(parameters.filters[iFilter].id));for(var iFilter=0;iFilter<this.lastInitializedParameters.filters.length;iFilter++)if($jQ.inArray(parseInt(this.lastInitializedParameters.filters[iFilter].id),newFilters)==-1){var filterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+this.lastInitializedParameters.filters[iFilter].id,filterObject=$jQ("div#"+filterHtmlId);filterObject.remove()}for(k in parameters.filters)if(parameters.filters.hasOwnProperty(k)){for(var fieldData=parameters.filters[k],filterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+fieldData.id,filterObject=$jQ("div#"+filterHtmlId),filterOptions={},i=1;void 0!=parameters.filters[k-i];){var previousFieldData=parameters.filters[k-i],previousFilterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+previousFieldData.id;if($jQ("div#"+previousFilterHtmlId).length){filterOptions.previousFilterHtmlId=previousFilterHtmlId;break}i++}if(filterOptions.filterValuesShowAll=parameters.filterValuesShowAll,0!=filterObject.length){switch(fieldData.type){case"manualSorter":case"select":case"mapper":case"multiselect":case"ranges":case"query":case"yesno":case"tree":case"radio":case"radiotree":if(this.controllerInstance.hideEmptyFilters){if(!("values"in fieldData&&0!=fieldData.values.length)){filterObject.hide();continue}filterObject.show()}if("values"in fieldData&&0!=fieldData.values.length&&(hasActiveFilterOptions=!0),null!=parameters.filterValuesShowAll&&"undefined"!=typeof parameters.filterValuesShowAll[fieldData.id]&&parameters.filterValuesShowAll[fieldData.id]===!0&&(null==this.lastInitializedParameters.filterValuesShowAll||"undefined"==typeof this.lastInitializedParameters.filterValuesShowAll[fieldData.id])){this.addFilter(k,fieldData,filterObject,filterOptions);continue}var existingFilterObjects=$jQ("div.searchFilterValues > div.searchFilterField",filterObject),existingFilters={};for(iFilter=0;iFilter<existingFilterObjects.length;iFilter++)""!=$jQ(existingFilterObjects[iFilter]).attr("rel")&&(existingFilters[$jQ(existingFilterObjects[iFilter]).attr("rel")]=existingFilterObjects[iFilter]);var missingValue=!1;for(var v in fieldData.values)if(fieldData.values.hasOwnProperty(v)){var filterField=$jQ('div.searchFilterField[rel="'+this.parseRel(v)+'"]',filterObject);0==filterField.length&&(missingValue=!0)}if(missingValue){this.addFilter(k,fieldData,filterObject,filterOptions);continue}var singleOption=!1;for(var k in fieldData.values)if(fieldData.values.hasOwnProperty(k)){var filterField=$jQ('div.searchFilterField[rel="'+this.parseRel(k)+'"]',filterObject);if(1==filterField.length){if(filterField=filterField.eq(0),filterField.data("count",fieldData.values[k].c),filterField.removeClass("disabled"),0==fieldData.values[k].c&&"query"!=fieldData.type)filterField.toggleClass("disabled",!0),$jQ("input",filterField).toggleClass("disabled",!0),"select"==fieldData.type||"yesno"==fieldData.type||"tree"==fieldData.type?this.toggleInput($jQ("input",htmlObject),fieldData,!1):"radio"==fieldData.type&&this.toggleInput($jQ("input",filterField),fieldData,!1);else if(singleOption)filterField.toggleClass("disabled",!0),$jQ("input",filterField).toggleClass("disabled",!0);else{if(filterField.removeClass("disabled"),"manualSorter"==fieldData.type||"mapper"==fieldData.type||"radio"==fieldData.type||"multiselect"==fieldData.type){var attr=$jQ("input",filterField).attr("disabled");"undefined"!=typeof attr&&attr!==!1&&$jQ("input",filterField).removeAttr("checked"),$jQ("input",filterField).removeClass("disabled").removeAttr("disabled")}this.toggleInput($jQ("input",filterField),fieldData,!0)}if("radio"==fieldData.type&&(fieldData.values[k].a?$jQ("input",filterField).attr("checked","checked").siblings().addClass("active"):$jQ("input",filterField).removeAttr("checked").siblings().removeClass("active")),filterField.children('span[rel="results"]').html(this.getResultCountString(fieldData.values[k].c)),existingFilters[this.parseRel(k)]=null,"tree"==fieldData.type||"radiotree"==fieldData.type)if(fieldData.subvalues&&fieldData.subvalues[k]&&websight.util.propCount(fieldData.subvalues[k])){var valueId=filterHtmlId+"Value"+k.replace(/[^0-9a-z]/gi,"_"),subvalueContainer=$jQ("div.searchFilterFieldTreeSubvalues",filterField);if(0!=subvalueContainer.length)for(var subValues=$jQ('div.searchFilterField[rel^="'+this.parseRel(k)+'|"]',subvalueContainer),iValue=0;iValue<subValues.length;iValue++){var subRel=subValues.eq(iValue).attr("rel").split(/\|/);subRel[1]in fieldData.subvalues[k]?($jQ(subValues.eq(iValue)).children('span[rel="results"]').html(this.getResultCountString(fieldData.subvalues[k][subRel[1]].c)),subValues.eq(iValue).removeClass("disabled"),this.toggleInput($jQ(subValues.eq(iValue)).children("input"),fieldData,!0)):($jQ(subValues.eq(iValue)).children('span[rel="results"]').html(this.getResultCountString(0)),subValues.eq(iValue).toggleClass("disabled",!0),this.toggleInput($jQ(subValues.eq(iValue)).children("input"),fieldData,!1))}else this.addSubvalues(k,filterField,fieldData,valueId)}else $jQ("div.searchFilterFieldTreeSubvalues",filterField).remove(),filterField.css("height","1.7em").css("overflow","hidden")}}if("radio"!=fieldData.type&&"radiotree"!=fieldData.type)for(var k in existingFilters)if(null!=existingFilters[k]){if(0==$jQ("input:checked",existingFilters[k]).length){$jQ(existingFilters[k]).toggleClass("disabled",!0);var filterInput=$jQ("input",existingFilters[k]);this.toggleInput(filterInput,fieldData,!1)}$jQ('span[rel="results"]',existingFilters[k]).html(this.getResultCountString(0))}break;case"dualslider":if(this.controllerInstance.hideEmptyFilters){filterObject.toggle(!(fieldData.min==fieldData.max));continue}var slider=$jQ('div.searchFilter[data-filter-id="'+fieldData.id+'"] div.searchFilterField div.searchFilterSlider',this.panelElement),currentValues=slider.slider("option","values");if(!("filterQuery"in queryParameters)||!(fieldData.id in queryParameters.filterQuery)||currentValues[0]==fieldData.min&&currentValues[1]==fieldData.max||currentValues[0]>queryParameters.filterQuery[fieldData.id].min||currentValues[1]<queryParameters.filterQuery[fieldData.id].max){slider.slider({change:null});var realMin=realMax=left=right=0;fieldData.id in queryParameters.filterQuery?(left=queryParameters.filterQuery[fieldData.id].left,right=queryParameters.filterQuery[fieldData.id].right,realMin=Math.min(fieldData.min,queryParameters.filterQuery[fieldData.id].min),realMax=Math.max(fieldData.max,queryParameters.filterQuery[fieldData.id].max)):(left=realMin=fieldData.min,right=realMax=fieldData.max),slider.slider("option","min",left),slider.slider("option","max",right),slider.slider("option","step",Math.round((right-left)/Math.min(right-left,fieldData.steps?fieldData.steps:50))),slider.slider("option","values",[realMin,realMax]),this.updateRangeSlider(filterObject,k,{values:[realMin,realMax]}),slider.slider({change:$jQ.proxy(this.handleChangedFilter,this)})}}initFilters++}else filterOptions.animation=!0,this.addFilter(k,fieldData,null,filterOptions)}$jQ.browser.msie&&parseInt($jQ.browser.version)>=8&&$jQ("html,body").scroll(),hasActiveFilterOptions&&this.panelElement.find('a[rel="reset"]').css("visibility","visible"),this.lastInitializedParameters=parameters},this.getResultCountString=function(results){return this.controllerInstance.indexSettings.view.cssVersion>=4?results:"("+results+")"},this.toggleInput=function(input,fieldData,state){input.unbind("change").unbind("click"),state?this.bindChangeEvent(fieldData,input):input.bind("click",function(event){return event.preventDefault(),!1}).bind("change",function(event){return event.preventDefault(),!1})},this.getFilterGroup=function(groupId){if(null==groupId&&(groupId=0),groupId in this.filterGroupCache)return this.filterGroupCache[groupId];var groupConfiguration=null;this.controllerInstance.indexSettings.filterGroups&&(groupConfiguration=this.controllerInstance.indexSettings.filterGroups[groupId]),null==groupConfiguration&&(groupConfiguration={name:"",default_collapsed:!1,collapsible:!1});var additionalClasses=1==groupConfiguration.default_collapsed?" closed":"";additionalClasses+=1==groupConfiguration.collapsible?" collapsible":"";var additionalStyle=0==groupConfiguration.default_collapsed?"":"display: none;",groupObject=$jQ('<div class="searchFilterGroup'+additionalClasses+'">'+(1==groupConfiguration.collapsible?'<div class="searchFilterGroupToggle"> </div>':"")+(groupConfiguration.name.length?"<h2>"+groupConfiguration.name+"</h2>":"")+'<div class="searchFilterGroupContainer" style="'+additionalStyle+'"> </div></div>').first();return this.formElement.append(groupObject),this.filterGroupCache[groupId]=groupObject,groupObject},this.getHeight=function(){return this.panelElement.outerHeight()},this.initialFilterTop=this.panelElement.offset().top,this.lastScrollTop=websight.util.getWindowScrollTop(),this.fixedFiltersCallback=function(){var containerOffset=controllerInstance.container.offset(),containerBottom=controllerInstance.container.height()+containerOffset.top,windowHeight=$jQ(window).height(),filterHeight=this.panelElement.outerHeight(!0),scrollTop=websight.util.getWindowScrollTop(),scrollBottom=Math.min(containerBottom,scrollTop+windowHeight),filterTop=this.panelElement.offset().top,filterBottom=filterTop+filterHeight,footerSpace=Math.max(0,scrollTop+windowHeight-containerBottom),availableWindowHeight=windowHeight-footerSpace,heightDelta=Math.abs(availableWindowHeight-filterHeight),scrollDelta=this.lastScrollTop-scrollTop,scrollingDown=scrollTop>this.lastScrollTop,fitsInWindow=availableWindowHeight>filterHeight,currentMinHeight=controllerInstance.container.css("min-height").replace(/px$/,"");if(currentMinHeight<filterHeight&&controllerInstance.container.css("min-height",filterHeight+"px"),fitsInWindow&&scrollTop>this.initialFilterTop||!fitsInWindow&&scrollTop>this.initialFilterTop+heightDelta?this.panelElement.hasClass("sqr-fixed")||(this.panelElement.addClass("sqr-fixed").css({position:"fixed"}),this.updatePanelWidth()):!scrollingDown&&scrollTop<=this.initialFilterTop&&(this.panelElement.removeClass("sqr-fixed").css({position:"relative",top:"",left:"",width:""}),this.updatePanelWidth()),this.isFilterpanelFixed=this.panelElement.hasClass("sqr-fixed"),this.isFilterpanelFixed){var leftOffset=-$jQ(window).scrollLeft()+containerOffset.left;leftOffset<0?this.panelElement.css("left",leftOffset):this.panelElement.css("left","auto")}var dragDown=filterBottom<=scrollBottom&&scrollingDown,dragUp=filterTop>=scrollTop&&!scrollingDown;if(dragDown&&fitsInWindow||dragUp)this.panelElement.css("top",0);else if(dragDown&&this.isFilterpanelFixed)this.panelElement.css("top",-heightDelta);else if(this.isFilterpanelFixed){var currentTop=parseInt(this.panelElement.css("top"),10),minTop=-heightDelta,scrolledTop=currentTop+scrollDelta,isPageAtBottom=scrollTop+windowHeight>=$jQ(document).height(),newTop=isPageAtBottom?minTop:scrolledTop;this.panelElement.css("top",newTop)}this.lastScrollTop=scrollTop},this.updatePanelWidth=function(){if(this.controllerInstance.indexSettings.view.cssVersion>=4){var resultsMargin=this.controllerInstance.searchCallback.resultsPanel.resultContainer.parent().css("margin-left");this.panelElement.css("width",resultsMargin)}},this.handleFilterFloatOnScroll=function(event){if(0==this.filterFloatInit){this.controllerInstance.parameters.filterContainer&&(filtersSelector=this.controllerInstance.parameters.filterContainer);$jQ(window).bind("scroll",this.proxiedFunctions.fixedFiltersCallback),this.lastScrollTop=0,this.proxiedFunctions.fixedFiltersCallback(),$jQ(this.controllerInstance).bind("updateFilters",$jQ.proxy(function(){this.filterFloatInit&&(this.lastScrollTop=0,this.proxiedFunctions.fixedFiltersCallback())},this)),this.filterFloatInit=!0}},this.disableFilterFloatOnScroll=function(){$jQ(window).unbind("scroll",this.proxiedFunctions.fixedFiltersCallback),this.filterFloatInit&&(this.panelElement.removeClass("sqr-fixed").css({position:"relative",top:"",left:"",width:""}),this.filterFloatInit=!1)},this.hasFloatingFilters=function(){return"filterFloatOnScroll"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.filterFloatOnScroll&&!websight.util.isTouch()},this.initializePanel=function(parameters){if(this.hasFloatingFilters()&&(this.filterFloatInit=!1,this.proxiedFunctions.handleFilterFloatOnScroll()),void 0!=parameters&&(this.parameters=parameters,this.structure=this.parameters.filters),this.panelElement.css("visibility","hidden"),this.panelElement.empty(),this.formElement.empty(),this.filterGroupCache={},this.parameters.html){var template=$jQ(this.parameters.html);this.panelElement.append(template);var filtersContainer=$jQ("div.filters, div.sqr-filters",this.panelElement);filtersContainer.append(this.formElement)}else this.panelElement.append(this.formElement);for(k in this.structure)this.addFilter(k,this.structure[k]);this.initializeClicks(),this.panelElement.css("visibility","visible"),this.panelElement.find('a[rel="reset"]').click($jQ.proxy(this.controllerInstance.resetFilters,this.controllerInstance)),this.lastInitializedParameters=this.parameters},this.clearLastFilterQuery=function(){this.lastFilterQuery=null},this.findMappedValue=function(values,value,type){for(var key in values)if(values[key].value==value&&values[key][type])return values[key][type];return!1},this.addFilter=function(k,fieldData,replaceObject,options){if(void 0==replaceObject&&(replaceObject=null),void 0==options&&(options={}),void 0!=fieldData){var hasActiveOptions=!1;if(!("fixedFilters"in this.controllerInstance.parameters&&(fieldData.id in this.controllerInstance.parameters.fixedFilters||fieldData.code in this.controllerInstance.parameters.fixedFilters))){var sortedValues=[];for(var l in fieldData.values)sortedValues[fieldData.values[l].p]=l;var filterGroup=filterGroupContainer=null;filterGroup=this.getFilterGroup(fieldData.group_id),filterGroupContainer=$jQ("div.searchFilterGroupContainer",filterGroup);var filterHtml="",addFilter=!1,filterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+fieldData.id,currentValue=null;null!=this.lastFilterQuery&&this.lastFilterQuery[fieldData.id]?currentValue=this.lastFilterQuery[fieldData.id]:this.defaultFilters[fieldData.id]&&(currentValue=this.defaultFilters[fieldData.id]);var extraClasses=extraFilterClasses="",filterValuesShowAll=!1;switch(null!=options.filterValuesShowAll&&fieldData.id in options.filterValuesShowAll&&1==options.filterValuesShowAll[fieldData.id]&&(filterValuesShowAll=!0),1==fieldData.collapsed&&0==filterValuesShowAll&&(extraFilterClasses+=" collapsed"),fieldData.type){case"query":if($jQ.isEmptyObject(fieldData.values))filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+extraClasses+'" rel="'+this.parseRel(k)+'"><label>Geen filter mogelijkheden</label></div>';else for(var index in sortedValues){var l=sortedValues[index],valueId=filterHtmlId+"Value"+l.replace(/[^0-9a-z]/gi,"_");filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+extraClasses+'" rel="'+this.parseRel(l)+'"><input type="checkbox" id="'+valueId+'" name="searchFilter'+fieldData.id+'" value="'+l+'" /> <label for="'+valueId+'">'+fieldData.values[l].l+"</label> </div>"}break;case"tree":case"radiotree":case"select":case"yesno":case"radio":if($jQ.isEmptyObject(fieldData.values))filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" rel="'+this.parseRel(k)+'"><label>Geen filter mogelijkheden</label></div>';else{var checked=!1,widgetType=fieldData.type.match(/^radio/)?"radio":"checkbox",singleOption=!1;for(var index in sortedValues){var l=sortedValues[index];if(fieldData.values.hasOwnProperty(l)){var extraLabelClasses=extraSpanClasses="",extraItemClasses=0==fieldData.values[l].c?" disabled":"";switch(inputDisabled=singleOption||0==fieldData.values[l].c?' disabled="disabled"':"",valueMatch=!1,fieldData.type){case"tree":case"radiotree":valueMatch=currentValue&&currentValue._==l;break;case"select":null!=currentValue&&(valueMatch=currentValue==l);break;case"radio":case"yesno":valueMatch=fieldData.values[l].a}checked=singleOption||valueMatch,inputDisabled+=checked?' checked="checked"':"",checked&&(extraLabelClasses+=" active",extraSpanClasses+=" active",hasActiveOptions=!0);var valueId=filterHtmlId+"Value"+l.replace(/[^0-9a-z]/gi,"_"),fieldName="searchFilter"+fieldData.id;"tree"!=fieldData.type&&"radiotree"!=fieldData.type||(fieldName+="[_]");var fieldHtml='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+extraClasses+extraItemClasses+'" rel="'+this.parseRel(l)+'"><input type="'+widgetType+'" '+inputDisabled+' id="'+valueId+'" name="'+fieldName+'" value="'+l+'" /> <label for="'+valueId+'" class="'+extraLabelClasses+'">'+fieldData.values[l].l+'</label> <span rel="results" class="'+extraSpanClasses+'">'+this.getResultCountString(fieldData.values[l].c)+"</span></div>";if(("tree"==fieldData.type||"radiotree"==fieldData.type)&&fieldData.subvalues&&fieldData.subvalues[l]&&websight.util.propCount(fieldData.subvalues[l])){var htmlObject=$jQ(fieldHtml).first();this.addSubvalues(l,htmlObject,fieldData,valueId),fieldHtml=$jQ("<div></div>").append(htmlObject).html()}filterHtml+=fieldHtml}}}break;case"mapper":var singleOption=!1;for(var index in sortedValues){var k=sortedValues[index];if(fieldData.values.hasOwnProperty(k)){var extraLabelClasses=extraSpanClasses="";extraItemClasses=0==fieldData.values[k].c?" disabled":"",inputDisabled=singleOption||0==fieldData.values[k].c?' disabled="disabled"':"",valueMatch=fieldData.values[k].a,checked=singleOption||valueMatch;var checkedStr="";checked&&(extraLabelClasses+=" active",extraSpanClasses+=" active",checkedStr=' checked="checked"',hasActiveOptions=!0);var valueId=filterHtmlId+"Value"+k.replace(/[^0-9a-z]/gi,"_"),title=fieldData.values[k].l.replace(/\<\!\-\-.+\-\-\>/,"");switch(filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+extraClasses+extraItemClasses+'" rel="'+this.parseRel(k)+'"><input type="checkbox" '+inputDisabled+checkedStr+' id="'+valueId+'"  name="searchFilter'+fieldData.id+'[]" value="'+k+'" />',fieldData.optionType){case"customImageMapping":case"useValueAsImage":var url="useValueAsImage"==fieldData.optionType?fieldData.values[k].l:this.findMappedValue(fieldData.value_settings,fieldData.values[k].l,"image");url?(filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">',filterHtml+='<img src="'+url+'" alt="'+fieldData.values[k].l+'" /></label> '):(filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">',filterHtml+=fieldData.values[k].l+"</label> ");break;case"customLabelMapping":filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">';var label=this.findMappedValue(fieldData.value_settings,fieldData.values[k].l,"label");filterHtml+=label?label:fieldData.values[k].l,filterHtml+="</label> ";break;case"customHexMapping":case"useValueAsHex":var hex="useValueAsHex"==fieldData.optionType?fieldData.values[k].l:this.findMappedValue(fieldData.value_settings,fieldData.values[k].l,"hex");hex?(hex=hex.indexOf("#")>-1?hex:"#"+hex,filterHtml+='<label style="color:'+hex+'" for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">'):filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">',filterHtml+=fieldData.values[k].l,filterHtml+="</label> ";break;default:filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">'+fieldData.values[k].l+"</label> "}filterHtml+='<span rel="results" class="'+extraSpanClasses+'">'+this.getResultCountString(fieldData.values[k].c)+"</span></div>"}}break;case"manualSorter":case"multiselect":case"ranges":var singleOption=!1;for(var index in sortedValues){var k=sortedValues[index];if(fieldData.values.hasOwnProperty(k)){var extraLabelClasses=extraSpanClasses="";switch(extraItemClasses=0==fieldData.values[k].c?" disabled":"",inputDisabled=singleOption||0==fieldData.values[k].c?' disabled="disabled"':"",fieldData.type){case"manualSorter":case"mapper":case"multiselect":valueMatch=fieldData.values[k].a;break;default:valueMatch=currentValue==k}checked=singleOption||valueMatch;var checkedStr="";checked&&(extraLabelClasses+=" active",extraSpanClasses+=" active",checkedStr=' checked="checked"',hasActiveOptions=!0);var valueId=filterHtmlId+"Value"+k.replace(/[^0-9a-z]/gi,"_"),title=fieldData.values[k].l.replace(/\<\!\-\-.+\-\-\>/,"");filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+extraClasses+extraItemClasses+'" rel="'+this.parseRel(k)+'"><input type="checkbox" '+inputDisabled+checkedStr+' id="'+valueId+'"  name="searchFilter'+fieldData.id+'[]" value="'+k+'" /> <label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">'+fieldData.values[k].l+'</label> <span rel="results" class="'+extraSpanClasses+'">'+this.getResultCountString(fieldData.values[k].c)+"</span></div>"}}break;case"slider":case"dualslider":var settings=this.getSliderSettings(fieldData);if(settings.min!=settings.max){var minLabel=settings.min;0==settings.min&&fieldData.zeroLabel&&(minLabel=fieldData.zeroLabel);var maxLabel=settings.max;fieldData.maxLabel&&fieldData.hasMaxInt&&(maxLabel=fieldData.maxLabel),filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" rel="'+this.parseRel(k)+'"><div class="searchFilterSliderLegendMin">'+minLabel+'</div><div class="searchFilterSlider"></div><div class="searchFilterSliderLegendMax">'+maxLabel+"</div></div>"}break;case"location":var distanceUnit="km";"miles"===fieldData.distanceUnits&&(distanceUnit="mi."),filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" rel="'+this.parseRel(k)+'"><div class="sqr-result-info" onclick="$jQ(this).hide();" id="'+filterHtmlId+'Response"></div><input autocomplete="off" type="text" id="'+filterHtmlId+'Search"/><i class="sqr-location-clear sqr-icon sqr-icon-cancel-circle"></i><input type="hidden" data-location id="'+filterHtmlId+'Location" name="searchFilter'+fieldData.id+'[location]"/><input type="hidden" data-distance id="'+filterHtmlId+'Distance" name="searchFilter'+fieldData.id+'[distance]" value="'+fieldData.defaultDistance+'" /><ul class="sqr-location-suggest" id="'+filterHtmlId+'SuggestValues"><li></li></ul><a href="#" id="'+filterHtmlId+'Geolocate"><i class="sqr-icon sqr-icon-gps"></i> '+this.parameters.locationGetCurrentText+'</a><div class="sqr-distance-label">'+this.parameters.locationDistanceText+' <span class="sqr-distance-value">'+fieldData.defaultDistance+'</span> <span class="sqr-distance-unit">'+distanceUnit+'</span></div> <div class="searchFilterSlider"></div></div>';
}if(addFilter=filterHtml.length){var html='<div class="searchFilter'+extraFilterClasses+'" data-filter-id="'+fieldData.id+'" id="'+filterHtmlId+'"><label>'+fieldData.label+'</label><div class="searchFilterValues">'+filterHtml+"</div></div>",htmlObject=$jQ(html);switch(fieldData.type){case"manualSorter":case"mapper":case"tree":case"radiotree":case"select":case"radio":case"yesno":case"multiselect":fieldData.moreValues&&htmlObject.append('<div class="searchFilterShowAllValues"><a href="#" rel="'+fieldData.id+'">'+this.parameters.moreOptionsText+"</a></div>")}switch(null!=replaceObject?$jQ(replaceObject).replaceWith(htmlObject):void 0!=options.previousFilterHtmlId&&$jQ("div#"+options.previousFilterHtmlId).length>0?filterGroupContainer.find("div#"+options.previousFilterHtmlId).after(htmlObject):filterGroupContainer.append(htmlObject),"function"==typeof this.getFilter&&this.getFilter(fieldData.id)===!1&&(this.structure[this.structure.length]=fieldData),fieldData.type){case"manualSorter":case"mapper":case"multiselect":case"select":$jQ("div.searchFilterValues",htmlObject).css("min-height",$jQ("div.searchFilterValues",htmlObject).height()+"px");case"query":case"tree":case"yesno":case"ranges":case"radio":case"radiotree":this.bindChangeEvent(fieldData,$jQ("input",htmlObject));break;case"slider":$jQ("div#"+filterHtmlId+" div.searchFilterSlider").attr("value",fieldData.min+";"+fieldData.max),$jQ("div#"+filterHtmlId+" div.searchFilterSlider").slider({min:fieldData.min,max:fieldData.max,value:fieldData.min,step:Math.round((fieldData.max-fieldData.min)/Math.min(fieldData.max-fieldData.min,fieldData.steps?fieldData.steps:50)),change:$jQ.proxy(this.handleChangedFilter,this)});break;case"dualslider":var sliderContainer=$jQ("div#"+filterHtmlId+" div.searchFilterSlider"),settings=this.getSliderSettings(fieldData);sliderContainer.slider({min:settings.left,max:settings.right,step:fieldData.step?fieldData.step:Math.round((settings.max-settings.min)/Math.min(settings.max-settings.min,fieldData.steps?fieldData.steps:50)),range:!0,values:[settings.min,settings.max],change:$jQ.proxy(this.handleChangedFilter,this),slide:$jQ.proxy(this.handleRangleSlider,this)}),$jQ("a.ui-slider-handle",sliderContainer).first().addClass("ui-slider-handle-left"),$jQ("a.ui-slider-handle",sliderContainer).last().addClass("ui-slider-handle-right");break;case"location":var locationInput=htmlObject.find('input[type="text"]');$jQ("a",htmlObject).bind("click",$jQ.proxy(function(event){event.preventDefault(),this.getGeolocation(fieldData,htmlObject)},this)),$jQ("ul",htmlObject).delegate("li","click",$jQ.proxy(function(event){this.handleGeoResultClick(event.currentTarget,locationInput)},this)),this.bindChangeEvent(fieldData,locationInput),$jQ(".sqr-location-clear",htmlObject).bind("click",$jQ.proxy(function(event){this.clearGeoFilter(fieldData.id,!0)},this)),$jQ("div#"+filterHtmlId+" div.searchFilterSlider").attr("value",fieldData.defaultDistance),$jQ("div#"+filterHtmlId+" div.searchFilterSlider").slider({min:fieldData.minimumDistance,max:fieldData.maximumDistance,value:fieldData.defaultDistance,step:fieldData.distanceStep,range:"min",change:$jQ.proxy(this.handleChangedFilter,this),slide:$jQ.proxy(function(event,ui){$jQ(event.target).siblings(".sqr-distance-label").find(".sqr-distance-value").text(ui.value),$jQ(event.target).siblings('input[data-distance=""]').val(ui.value)},this)})}this.initializeClicksByFields($jQ("div#"+filterHtmlId))}hasActiveOptions&&this.panelElement.find('a[rel="reset"]').css("visibility","visible")}}},this.getSliderSettings=function(fieldData){var settings={"left":fieldData.min,"right":fieldData.max,"min":fieldData.min,"max":fieldData.max};if(null!=this.lastFilterQuery&&fieldData.id in this.lastFilterQuery){var options=["left","right","min","max"];for(name in options)key=options[name],settings[key]=this.lastFilterQuery[fieldData.id][key]}return settings},this.bindChangeEvent=function(fieldData,selector){switch(fieldData.type){case"query":selector.bind("change",$jQ.proxy(function(event){this.handleQueryFilter(event)},this));break;case"location":selector.bind("keydown",$jQ.proxy(function(event){this.handleLocationSubmit(event,fieldData,selector)},this)),selector.bind("keyup",$jQ.proxy(function(event){this.handleLocationInput(event,fieldData,selector)},this));break;case"tree":case"select":case"yesno":selector.bind("change",this.disableOtherSelects);case"manualSorter":case"mapper":case"ranges":case"multiselect":case"radio":case"radiotree":selector.bind("change",$jQ.proxy(function(event){this.handleChangedFilter(event)},this))}},this.checkSingleOption=function(values){var singleOption=!1,resultTotal=0;for(var k in values)values[k].c&&(resultTotal+=parseInt(String(values[k].c).replace(/\./,"")));return resultTotal==this.parameters.numberOfResults&&1==websight.util.propCount(values)&&(singleOption=!0),singleOption},this.showHiddenFilters=function(parameters){this.parameters=parameters,this.structure=this.parameters.filters;for(k in parameters.filters){var fieldData=parameters.filters[k],filterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+fieldData.id,filterObject=$jQ("div#"+filterHtmlId);0==filterObject.length&&this.addFilter(k,fieldData)}},this.addSubvalues=function(k,filterField,fieldData,valueId){subvalueContainer=$jQ('<div class="searchFilterFieldTreeSubvalues"/>'),subvalueContainer.appendTo(filterField),subvalueContainer=subvalueContainer.first();var currentValue=null;null!=this.lastFilterQuery&&this.lastFilterQuery[fieldData.id].values&&this.lastFilterQuery[fieldData.id]._==k?currentValue=this.lastFilterQuery[fieldData.id].values:this.defaultFilters&&this.defaultFilters[fieldData.id]&&this.defaultFilters[fieldData.id]._==k&&this.defaultFilters[fieldData.id].values&&(currentValue=this.defaultFilters[fieldData.id].values);var filterHtml="",iItem=0;for(var l in fieldData.subvalues[k]){if(fieldData.subvalues[k].hasOwnProperty(l)){var subValueId=valueId+"_"+l.replace(/[^0-9a-z]/gi,"_"),elementType="radiotree"==fieldData.type?"radio":"checkbox",isCurrentValue=!1;isCurrentValue=null==currentValue?0==iItem:currentValue==l;var checked="radiotree"==fieldData.type&&isCurrentValue?' checked="checked"':"",extraClasses="radiotree"==fieldData.type&&isCurrentValue?"active":"";filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" rel="'+this.parseRel(k)+"|"+this.parseRel(l)+'"><input type="'+elementType+'" id="'+subValueId+'" name="searchFilter'+fieldData.id+'[]" '+checked+' value="'+l+'" /> <label for="'+subValueId+'" class="'+extraClasses+'">'+fieldData.subvalues[k][l].l+'</label> <span rel="results" class="'+extraClasses+'">'+this.getResultCountString(fieldData.subvalues[k][l].c)+"</span></div>"}iItem++}filterField.css("height","auto").css("overflow","auto"),subvalueContainer.html(filterHtml),$jQ("input",subvalueContainer).bind("change",$jQ.proxy(function(event){this.handleChangedFilter(event)},this))},this.toggleFilterGroup=function(event){var groupObject=$jQ(event.target).closest("div.searchFilterGroup"),collapsed=$jQ("div.searchFilterGroupContainer div.searchFilter.collapsed",groupObject).length,doCollapse=!0;collapsed>0&&(doCollapse=collapsed<$jQ("div.searchFilterGroupContainer div.searchFilter",groupObject).length),$jQ("div.searchFilterGroupContainer div.searchFilter",groupObject).toggleClass("collapsed",doCollapse),groupObject.toggleClass("collapsed")},this.toggleFilter=function(event){var filterObject=$jQ(event.target).closest("div.searchFilter");filterObject.toggleClass("collapsed")},this.handleResponsiveResize=function(activeBreakpoint,newBreakpoint){if(null!=activeBreakpoint&&null==newBreakpoint?this.hasFloatingFilters()&&(this.filterFloatInit=!1,this.proxiedFunctions.handleFilterFloatOnScroll()):null==activeBreakpoint&&null!=newBreakpoint&&this.hasFloatingFilters()&&this.disableFilterFloatOnScroll(),null==activeBreakpoint){var resultsMargin=this.controllerInstance.searchCallback.resultsPanel.resultContainer.parent().css("margin-left");this.panelElement.css("width",resultsMargin)}},this.handleOpen=function(){this.hasFloatingFilters()&&(this.filterFloatInit=!1,this.proxiedFunctions.handleFilterFloatOnScroll()),this.updatePanelWidth()},this.handleClose=function(){this.hasFloatingFilters()&&this.disableFilterFloatOnScroll()},this.handleLocationSubmit=function(event,fieldData,inputField){var suggestions=$jQ(inputField).siblings(".sqr-location-suggest"),resultInfoObj=$jQ(inputField).siblings(".sqr-result-info");if(13!=event.keyCode);else if(event.preventDefault(),event.stopImmediatePropagation(),suggestions.find("li").is(":visible")){suggestions.hide(),resultInfoObj.hide();var firstItem=suggestions.find("li").eq(0);this.handleGeoResultClick(firstItem,inputField)}},this.handleLocationInput=function(event,fieldData,inputField){var suggestions=$jQ(inputField).siblings(".sqr-location-suggest"),resultInfoObj=$jQ(inputField).siblings(".sqr-result-info");if(event.keyCode>=65||event.keyCode>=48&&event.keyCode<=57||8==event.keyCode||32==event.keyCode||46==event.keyCode||0==event.keyCode)if(this.handleLocationInputTimeout&&(clearTimeout(this.handleLocationInputTimeout),this.handleLocationInputTimeout=null),0==$jQ(event.target).val().length)suggestions.hide(),resultInfoObj.hide();else{var self=this;this.handleLocationInputTimeout=setTimeout($jQ.proxy(function(){$jQ.ajax({url:"https://api.sooqr.com/v1/geo/search",jsonp:"callback",dataType:"jsonp",data:{query:$jQ(event.target).val(),country:fieldData.countries,group:"city",results:10},success:function(response){if(response.results&&response.results.length){suggestions.empty();for(var k in response.results)suggestions.append('<li data-latitude="'+response.results[k].latitude+'" data-longitude="'+response.results[k].longitude+'"><a>'+response.results[k].name+", "+response.results[k].countrycode+" ("+response.results[k].postalcode+")</a></li>");suggestions.show(),resultInfoObj.hide()}else suggestions.hide(),self.processGeoResultInfo(resultInfoObj,self.parameters.locationNotFoundText)},error:function(response){self.processGeoResultInfo(resultInfoObj,self.parameters.locationNotFoundText)}})},this),200)}},this.toggleGeoFieldReadonly=function(inputField,state){inputField.attr("readonly",!!state&&"readonly"),inputField.toggleClass("sqr-readonly",state)},this.handleGeoResultClick=function(item,inputField){item=$jQ(item),inputField.val(item.text()),this.toggleGeoFieldReadonly(inputField,!0),inputField.siblings('input[data-location=""]').val(item.data("latitude")+","+item.data("longitude")),inputField.siblings("ul").hide(),inputField.siblings(".sqr-location-clear").show();var filterId=$jQ(inputField).closest("div.searchFilter").data("filter-id");this.handleChangedFilterById(filterId)},this.getGeolocation=function(filterObject,htmlObject){var resultInfoObj=htmlObject.find(".sqr-result-info");navigator.geolocation?navigator.geolocation.getCurrentPosition($jQ.proxy(function(position){var self=this;$jQ.ajax({url:"https://api.sooqr.com/v1/geo/near",jsonp:"callback",dataType:"jsonp",data:{lat:position.coords.latitude,lng:position.coords.longitude,country:filterObject.countries,results:1},success:function(response){var inputField=$jQ("input",htmlObject);if(response.results&&response.results.length){var dummyItem=$jQ('<li data-latitude="'+response.results[0].latitude+'" data-longitude="'+response.results[0].longitude+'"><a>'+response.results[0].name+", "+response.results[0].countrycode+" ("+response.results[0].postalcode+")</a></li>");self.handleGeoResultClick(dummyItem,htmlObject.find('input[type="text"]')),self.processGeoResultInfo(resultInfoObj,self.parameters.locationFoundText)}else self.processGeoResultInfo(resultInfoObj,self.parameters.locationNotFoundText),self.toggleGeoFieldReadonly(inputField,!1)},error:function(response){self.processGeoResultInfo(resultInfoObj,self.parameters.locationNotFoundText)}})},this)):this.processGeoResultInfo(resultInfoObj,this.parameters.locationNotSupportedText)},this.processGeoResultInfo=function(resultInfoObj,resultInfo){resultInfo&&resultInfoObj.text(resultInfo).fadeIn(400,function(){setTimeout(function(){resultInfoObj.fadeOut()},5e3)})},this.getFilter=function(filterId){for(k in this.structure)if(this.structure.hasOwnProperty(k)&&this.structure[k].id==filterId)return this.structure[k];return!1},this.getFilterType=function(filterId){var filter=this.getFilter(filterId);return filter!==!1&&filter.type},this.clearGeoFilter=function(filterId,refresh){var htmlObject=$jQ('div[data-filter-id="'+filterId+'"]',this.panelElement),resultInfoObj=$jQ(htmlObject).find(".sqr-result-info");resultInfoObj.hide();var suggestions=$jQ(htmlObject).siblings(".sqr-location-suggest");suggestions.hide(),$jQ(htmlObject).find('input[type="text"], input[data-location=""]').val(""),$jQ(htmlObject).find(".sqr-location-clear").hide(),this.toggleGeoFieldReadonly(htmlObject.find('input[type="text"]'),!1),refresh&&this.handleChangedFilterById(filterId)},this.proxiedFunctions={handleFilterFloatOnScroll:$jQ.proxy(this.handleFilterFloatOnScroll,this),fixedFiltersCallback:$jQ.proxy(this.fixedFiltersCallback,this),handleOpen:$jQ.proxy(this.handleOpen,this),handleClose:$jQ.proxy(this.handleClose,this)},this.initializeClicks=function(){if($jQ("div.searchFilterGroup.collapsible h2, div.searchFilterGroup div.searchFilterGroupToggle",this.formElement).bind("click",$jQ.proxy(function(event){this.toggleFilterGroup(event),event.stopPropagation()},this)),this.parameters.hasHiddenFilters){var moreFiltersBlock=$jQ('<div class="searchFilterShowAllFilters"><a href="#">Toon alle filters</a></div>');this.panelElement.append(moreFiltersBlock),$jQ("a",moreFiltersBlock).bind("click",$jQ.proxy(this.showAllFilters,this))}},this.initializeClicksByFields=function(fields){return $jQ("label:first",fields).bind("click",$jQ.proxy(function(event){this.toggleFilter(event),event.stopPropagation()},this)),$jQ(fields).delegate("div.searchFilterShowAllValues a","click",$jQ.proxy(function(event){return this.showAllFilterValues(event)},this)),$jQ(fields).delegate("div.searchFilterHideAllValues a","click",$jQ.proxy(function(event){return this.hideAllFilterValues(event)},this)),fields},this.parseRel=function(rel){return rel.replace("<!--","commentStart").replace("-->","commentEnd").replace("/","").replace('"',"doublequote")},$jQ(this.controllerInstance).bind("open",this.proxiedFunctions.handleOpen),$jQ(this.controllerInstance).bind("close",this.proxiedFunctions.handleClose),this.initializePanel()},/*!
 * jQuery UI 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
function(c,j){function k(a){return!c(a).parents().andSelf().filter(function(){return"hidden"===c.curCSS(this,"visibility")||c.expr.filters.hidden(this)}).length}c.ui=c.ui||{},c.ui.version||(c.extend(c.ui,{version:"1.8.11",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),c.fn.extend({_focus:c.fn.focus,focus:function(a,b){return"number"==typeof a?this.each(function(){var d=this;setTimeout(function(){c(d).focus(),b&&b.call(d)},a)}):this._focus.apply(this,arguments)},scrollParent:function(){var a;return a=c.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(c.curCSS(this,"position",1))&&/(auto|scroll)/.test(c.curCSS(this,"overflow",1)+c.curCSS(this,"overflow-y",1)+c.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(c.curCSS(this,"overflow",1)+c.curCSS(this,"overflow-y",1)+c.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!a.length?c(document):a},zIndex:function(a){if(a!==j)return this.css("zIndex",a);if(this.length){a=c(this[0]);for(var b;a.length&&a[0]!==document;){if(b=a.css("position"),("absolute"===b||"relative"===b||"fixed"===b)&&(b=parseInt(a.css("zIndex"),10),!isNaN(b)&&0!==b))return b;a=a.parent()}}return 0},disableSelection:function(){return this.bind((c.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),c.each(["Width","Height"],function(a,b){function d(f,g,l,m){return c.each(e,function(){g-=parseFloat(c.curCSS(f,"padding"+this,!0))||0,l&&(g-=parseFloat(c.curCSS(f,"border"+this+"Width",!0))||0),m&&(g-=parseFloat(c.curCSS(f,"margin"+this,!0))||0)}),g}var e="Width"===b?["Left","Right"]:["Top","Bottom"],h=b.toLowerCase(),i={innerWidth:c.fn.innerWidth,innerHeight:c.fn.innerHeight,outerWidth:c.fn.outerWidth,outerHeight:c.fn.outerHeight};c.fn["inner"+b]=function(f){return f===j?i["inner"+b].call(this):this.each(function(){c(this).css(h,d(this,f)+"px")})},c.fn["outer"+b]=function(f,g){return"number"!=typeof f?i["outer"+b].call(this,f):this.each(function(){c(this).css(h,d(this,f,!0,g)+"px")})}}),c.extend(c.expr[":"],{data:function(a,b,d){return!!c.data(a,d[3])},focusable:function(a){var b=a.nodeName.toLowerCase(),d=c.attr(a,"tabindex");return"area"===b?(b=a.parentNode,d=b.name,!(!a.href||!d||"map"!==b.nodeName.toLowerCase())&&(a=c("img[usemap=#"+d+"]")[0],!!a&&k(a))):(/input|select|textarea|button|object/.test(b)?!a.disabled:"a"==b?a.href||!isNaN(d):!isNaN(d))&&k(a)},tabbable:function(a){var b=c.attr(a,"tabindex");return(isNaN(b)||b>=0)&&c(a).is(":focusable")}}),c(function(){var a=document.body,b=a.appendChild(b=document.createElement("div"));c.extend(b.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),c.support.minHeight=100===b.offsetHeight,c.support.selectstart="onselectstart"in b,a.removeChild(b).style.display="none"}),c.extend(c.ui,{plugin:{add:function(a,b,d){a=c.ui[a].prototype;for(var e in d)a.plugins[e]=a.plugins[e]||[],a.plugins[e].push([b,d[e]])},call:function(a,b,d){if((b=a.plugins[b])&&a.element[0].parentNode)for(var e=0;e<b.length;e++)a.options[b[e][0]]&&b[e][1].apply(a.element,d)}},contains:function(a,b){return document.compareDocumentPosition?16&a.compareDocumentPosition(b):a!==b&&a.contains(b)},hasScroll:function(a,b){if("hidden"===c(a).css("overflow"))return!1;b=b&&"left"===b?"scrollLeft":"scrollTop";var d=!1;return a[b]>0||(a[b]=1,d=a[b]>0,a[b]=0,d)},isOverAxis:function(a,b,d){return a>b&&a<b+d},isOver:function(a,b,d,e,h,i){return c.ui.isOverAxis(a,d,h)&&c.ui.isOverAxis(b,e,i)}}))}($jQ),/*!
 * jQuery UI Widget 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
function(b,j){if(b.cleanData){var k=b.cleanData;b.cleanData=function(a){for(var d,c=0;null!=(d=a[c]);c++)b(d).triggerHandler("remove");k(a)}}else{var l=b.fn.remove;b.fn.remove=function(a,c){return this.each(function(){return c||a&&!b.filter(a,[this]).length||b("*",this).add([this]).each(function(){b(this).triggerHandler("remove")}),l.call(b(this),a,c)})}}b.widget=function(a,c,d){var f,e=a.split(".")[0];a=a.split(".")[1],f=e+"-"+a,d||(d=c,c=b.Widget),b.expr[":"][f]=function(h){return!!b.data(h,a)},b[e]=b[e]||{},b[e][a]=function(h,g){arguments.length&&this._createWidget(h,g)},c=new c,c.options=b.extend(!0,{},c.options),b[e][a].prototype=b.extend(!0,c,{namespace:e,widgetName:a,widgetEventPrefix:b[e][a].prototype.widgetEventPrefix||a,widgetBaseClass:f},d),b.widget.bridge(a,b[e][a])},b.widget.bridge=function(a,c){b.fn[a]=function(d){var e="string"==typeof d,f=Array.prototype.slice.call(arguments,1),h=this;return d=!e&&f.length?b.extend.apply(null,[!0,d].concat(f)):d,e&&"_"===d.charAt(0)?h:(e?this.each(function(){var g=b.data(this,a),i=g&&b.isFunction(g[d])?g[d].apply(g,f):g;if(i!==g&&i!==j)return h=i,!1}):this.each(function(){var g=b.data(this,a);g?g.option(d||{})._init():b.data(this,a,new c(d,this))}),h)}},b.Widget=function(a,c){arguments.length&&this._createWidget(a,c)},b.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(a,c){b.data(c,this.widgetName,this),this.element=b(c),this.options=b.extend(!0,{},this.options,this._getCreateOptions(),a);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return b.metadata&&b.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(a,c){var d=a;if(0===arguments.length)return b.extend({},this.options);if("string"==typeof a){if(c===j)return this.options[a];d={},d[a]=c}return this._setOptions(d),this},_setOptions:function(a){var c=this;return b.each(a,function(d,e){c._setOption(d,e)}),this},_setOption:function(a,c){return this.options[a]=c,"disabled"===a&&this.widget()[c?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",c),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(a,c,d){var e=this.options[a];if(c=b.Event(c),c.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase(),d=d||{},c.originalEvent){a=b.event.props.length;for(var f;a;)f=b.event.props[--a],c[f]=c.originalEvent[f]}return this.element.trigger(c,d),!(b.isFunction(e)&&e.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}}($jQ),/*!
 * jQuery UI Mouse 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *  jquery.ui.widget.js
 */
function(b){b.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var a=this;this.element.bind("mousedown."+this.widgetName,function(c){return a._mouseDown(c)}).bind("click."+this.widgetName,function(c){if(!0===b.data(c.target,a.widgetName+".preventClickEvent"))return b.removeData(c.target,a.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(a){if(a.originalEvent=a.originalEvent||{},!a.originalEvent.mouseHandled){this._mouseStarted&&this._mouseUp(a),this._mouseDownEvent=a;var c=this,e=1==a.which,f="string"==typeof this.options.cancel&&b(a.target).parents().add(a.target).filter(this.options.cancel).length;return!(e&&!f&&this._mouseCapture(a))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){c.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&(this._mouseStarted=this._mouseStart(a)!==!1,!this._mouseStarted)?(a.preventDefault(),!0):(!0===b.data(a.target,this.widgetName+".preventClickEvent")&&b.removeData(a.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(d){return c._mouseMove(d)},this._mouseUpDelegate=function(d){return c._mouseUp(d)},b(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),a.preventDefault(),a.originalEvent.mouseHandled=!0))}},_mouseMove:function(a){return!b.browser.msie||document.documentMode>=9||a.button?this._mouseStarted?(this._mouseDrag(a),a.preventDefault()):(this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&((this._mouseStarted=this._mouseStart(this._mouseDownEvent,a)!==!1)?this._mouseDrag(a):this._mouseUp(a)),!this._mouseStarted):this._mouseUp(a)},_mouseUp:function(a){return b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,a.target==this._mouseDownEvent.target&&b.data(a.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(a)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}($jQ),/*
 * jQuery UI Position 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Position
 */
function(c){c.ui=c.ui||{};var n=/left|center|right/,o=/top|center|bottom/,t=c.fn.position,u=c.fn.offset;c.fn.position=function(b){if(!b||!b.of)return t.apply(this,arguments);b=c.extend({},b);var h,k,j,a=c(b.of),d=a[0],g=(b.collision||"flip").split(" "),e=b.offset?b.offset.split(" "):[0,0];return 9===d.nodeType?(h=a.width(),k=a.height(),j={top:0,left:0}):d.setTimeout?(h=a.width(),k=a.height(),j={top:a.scrollTop(),left:a.scrollLeft()}):d.preventDefault?(b.at="left top",h=k=0,j={top:b.of.pageY,left:b.of.pageX}):(h=a.outerWidth(),k=a.outerHeight(),j=a.offset()),c.each(["my","at"],function(){var f=(b[this]||"").split(" ");1===f.length&&(f=n.test(f[0])?f.concat(["center"]):o.test(f[0])?["center"].concat(f):["center","center"]),f[0]=n.test(f[0])?f[0]:"center",f[1]=o.test(f[1])?f[1]:"center",b[this]=f}),1===g.length&&(g[1]=g[0]),e[0]=parseInt(e[0],10)||0,1===e.length&&(e[1]=e[0]),e[1]=parseInt(e[1],10)||0,"right"===b.at[0]?j.left+=h:"center"===b.at[0]&&(j.left+=h/2),"bottom"===b.at[1]?j.top+=k:"center"===b.at[1]&&(j.top+=k/2),j.left+=e[0],j.top+=e[1],this.each(function(){var r,f=c(this),l=f.outerWidth(),m=f.outerHeight(),p=parseInt(c.curCSS(this,"marginLeft",!0))||0,q=parseInt(c.curCSS(this,"marginTop",!0))||0,v=l+p+(parseInt(c.curCSS(this,"marginRight",!0))||0),w=m+q+(parseInt(c.curCSS(this,"marginBottom",!0))||0),i=c.extend({},j);"right"===b.my[0]?i.left-=l:"center"===b.my[0]&&(i.left-=l/2),"bottom"===b.my[1]?i.top-=m:"center"===b.my[1]&&(i.top-=m/2),i.left=Math.round(i.left),i.top=Math.round(i.top),r={left:i.left-p,top:i.top-q},c.each(["left","top"],function(s,x){c.ui.position[g[s]]&&c.ui.position[g[s]][x](i,{targetWidth:h,targetHeight:k,elemWidth:l,elemHeight:m,collisionPosition:r,collisionWidth:v,collisionHeight:w,offset:e,my:b.my,at:b.at})}),c.fn.bgiframe&&f.bgiframe(),f.offset(c.extend(i,{using:b.using}))})},c.ui.position={fit:{left:function(b,a){var d=c(window);d=a.collisionPosition.left+a.collisionWidth-d.width()-d.scrollLeft(),b.left=d>0?b.left-d:Math.max(b.left-a.collisionPosition.left,b.left)},top:function(b,a){var d=c(window);d=a.collisionPosition.top+a.collisionHeight-d.height()-d.scrollTop(),b.top=d>0?b.top-d:Math.max(b.top-a.collisionPosition.top,b.top)}},flip:{left:function(b,a){if("center"!==a.at[0]){var d=c(window);d=a.collisionPosition.left+a.collisionWidth-d.width()-d.scrollLeft();var g="left"===a.my[0]?-a.elemWidth:"right"===a.my[0]?a.elemWidth:0,e="left"===a.at[0]?a.targetWidth:-a.targetWidth,h=-2*a.offset[0];b.left+=a.collisionPosition.left<0?g+e+h:d>0?g+e+h:0}},top:function(b,a){if("center"!==a.at[1]){var d=c(window);d=a.collisionPosition.top+a.collisionHeight-d.height()-d.scrollTop();var g="top"===a.my[1]?-a.elemHeight:"bottom"===a.my[1]?a.elemHeight:0,e="top"===a.at[1]?a.targetHeight:-a.targetHeight,h=-2*a.offset[1];b.top+=a.collisionPosition.top<0?g+e+h:d>0?g+e+h:0}}}},c.offset.setOffset||(c.offset.setOffset=function(b,a){/static/.test(c.curCSS(b,"position"))&&(b.style.position="relative");var d=c(b),g=d.offset(),e=parseInt(c.curCSS(b,"top",!0),10)||0,h=parseInt(c.curCSS(b,"left",!0),10)||0;g={top:a.top-g.top+e,left:a.left-g.left+h},"using"in a?a.using.call(b,g):d.css(g)},c.fn.offset=function(b){var a=this[0];return a&&a.ownerDocument?b?this.each(function(){c.offset.setOffset(this,b)}):u.call(this):null})}($jQ),/*
 * jQuery UI Slider 1.8.11
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Slider
 *
 * Depends:
 *  jquery.ui.core.js
 *  jquery.ui.mouse.js
 *  jquery.ui.widget.js
 */
function(d){d.widget("ui.slider",d.ui.mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var b=this,a=this.options;if(this._mouseSliding=this._keySliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),a.disabled&&this.element.addClass("ui-slider-disabled ui-disabled"),this.range=d([]),a.range&&(a.range===!0?(this.range=d("<div></div>"),a.values||(a.values=[this._valueMin(),this._valueMin()]),a.values.length&&2!==a.values.length&&(a.values=[a.values[0],a.values[0]])):this.range=d("<div></div>"),this.range.appendTo(this.element).addClass("ui-slider-range"),"min"!==a.range&&"max"!==a.range||this.range.addClass("ui-slider-range-"+a.range),this.range.addClass("ui-widget-header")),0===d(".ui-slider-handle",this.element).length&&d("<a href='#'></a>").appendTo(this.element).addClass("ui-slider-handle"),a.values&&a.values.length)for(;d(".ui-slider-handle",this.element).length<a.values.length;)d("<a href='#'></a>").appendTo(this.element).addClass("ui-slider-handle");this.handles=d(".ui-slider-handle",this.element).addClass("ui-state-default ui-corner-all"),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(c){c.preventDefault()}).hover(function(){a.disabled||d(this).addClass("ui-state-hover")},function(){d(this).removeClass("ui-state-hover")}).focus(function(){a.disabled?d(this).blur():(d(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),d(this).addClass("ui-state-focus"))}).blur(function(){d(this).removeClass("ui-state-focus")}),this.handles.each(function(c){d(this).data("index.ui-slider-handle",c)}),this.handles.keydown(function(c){var h,g,i,e=!0,f=d(this).data("index.ui-slider-handle");if(!b.options.disabled){switch(c.keyCode){case d.ui.keyCode.HOME:case d.ui.keyCode.END:case d.ui.keyCode.PAGE_UP:case d.ui.keyCode.PAGE_DOWN:case d.ui.keyCode.UP:case d.ui.keyCode.RIGHT:case d.ui.keyCode.DOWN:case d.ui.keyCode.LEFT:if(e=!1,!b._keySliding&&(b._keySliding=!0,d(this).addClass("ui-state-active"),h=b._start(c,f),h===!1))return}switch(i=b.options.step,h=g=b.options.values&&b.options.values.length?b.values(f):b.value(),c.keyCode){case d.ui.keyCode.HOME:g=b._valueMin();break;case d.ui.keyCode.END:g=b._valueMax();break;case d.ui.keyCode.PAGE_UP:g=b._trimAlignValue(h+(b._valueMax()-b._valueMin())/5);break;case d.ui.keyCode.PAGE_DOWN:g=b._trimAlignValue(h-(b._valueMax()-b._valueMin())/5);break;case d.ui.keyCode.UP:case d.ui.keyCode.RIGHT:if(h===b._valueMax())return;g=b._trimAlignValue(h+i);break;case d.ui.keyCode.DOWN:case d.ui.keyCode.LEFT:if(h===b._valueMin())return;g=b._trimAlignValue(h-i)}return b._slide(c,f,g),e}}).keyup(function(c){var e=d(this).data("index.ui-slider-handle");b._keySliding&&(b._keySliding=!1,b._stop(c,e),b._change(c,e),d(this).removeClass("ui-state-active"))}),this._refreshValue(),this._animateOff=!1},destroy:function(){return this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy(),this},_mouseCapture:function(b){var c,e,f,h,g,a=this.options;return!a.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),c=this._normValueFromMouse({x:b.pageX,y:b.pageY}),e=this._valueMax()-this._valueMin()+1,h=this,this.handles.each(function(i){var j=Math.abs(c-h.values(i));e>j&&(e=j,f=d(this),g=i)}),a.range===!0&&this.values(1)===a.min&&(g+=1,f=d(this.handles[g])),this._start(b,g)!==!1&&(this._mouseSliding=!0,h._handleIndex=g,f.addClass("ui-state-active").focus(),a=f.offset(),this._clickOffset=d(b.target).parents().andSelf().is(".ui-slider-handle")?{left:b.pageX-a.left-f.width()/2,top:b.pageY-a.top-f.height()/2-(parseInt(f.css("borderTopWidth"),10)||0)-(parseInt(f.css("borderBottomWidth"),10)||0)+(parseInt(f.css("marginTop"),10)||0)}:{left:0,top:0},this.handles.hasClass("ui-state-hover")||this._slide(b,g,c),this._animateOff=!0))},_mouseStart:function(){return!0},_mouseDrag:function(b){var a=this._normValueFromMouse({x:b.pageX,y:b.pageY});return this._slide(b,this._handleIndex,a),!1},_mouseStop:function(b){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(b,this._handleIndex),this._change(b,this._handleIndex),this._clickOffset=this._handleIndex=null,this._animateOff=!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(b){var a;return"horizontal"===this.orientation?(a=this.elementSize.width,b=b.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(a=this.elementSize.height,b=b.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),a=b/a,a>1&&(a=1),a<0&&(a=0),"vertical"===this.orientation&&(a=1-a),b=this._valueMax()-this._valueMin(),this._trimAlignValue(this._valueMin()+a*b)},_start:function(b,a){var c={handle:this.handles[a],value:this.value()};return this.options.values&&this.options.values.length&&(c.value=this.values(a),c.values=this.values()),this._trigger("start",b,c)},_slide:function(b,a,c){var e;this.options.values&&this.options.values.length?(e=this.values(a?0:1),2===this.options.values.length&&this.options.range===!0&&(0===a&&c>e||1===a&&c<e)&&(c=e),c!==this.values(a)&&(e=this.values(),e[a]=c,b=this._trigger("slide",b,{handle:this.handles[a],value:c,values:e}),this.values(a?0:1),b!==!1&&this.values(a,c,!0))):c!==this.value()&&(b=this._trigger("slide",b,{handle:this.handles[a],value:c}),b!==!1&&this.value(c))},_stop:function(b,a){var c={handle:this.handles[a],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(a),c.values=this.values()),this._trigger("stop",b,c)},_change:function(b,a){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[a],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(a),c.values=this.values()),this._trigger("change",b,c)}},value:function(b){return arguments.length&&(this.options.value=this._trimAlignValue(b),this._refreshValue(),this._change(null,0)),this._value()},values:function(b,a){var c,e,f;if(arguments.length>1&&(this.options.values[b]=this._trimAlignValue(a),this._refreshValue(),this._change(null,b)),!arguments.length)return this._values();if(!d.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(b):this.value();for(c=this.options.values,e=arguments[0],f=0;f<c.length;f+=1)c[f]=this._trimAlignValue(e[f]),this._change(null,f);this._refreshValue()},_setOption:function(b,a){var c,e=0;switch(d.isArray(this.options.values)&&(e=this.options.values.length),d.Widget.prototype._setOption.apply(this,arguments),b){case"disabled":a?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.attr("disabled","disabled"),this.element.addClass("ui-disabled")):(this.handles.removeAttr("disabled"),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),c=0;c<e;c+=1)this._change(null,c);this._animateOff=!1}},_value:function(){var b=this.options.value;return b=this._trimAlignValue(b)},_values:function(b){var a,c;if(arguments.length)return a=this.options.values[b],a=this._trimAlignValue(a);for(a=this.options.values.slice(),c=0;c<a.length;c+=1)a[c]=this._trimAlignValue(a[c]);return a},_trimAlignValue:function(b){if(b<=this._valueMin())return this._valueMin();if(b>=this._valueMax())return this._valueMax();var a=this.options.step>0?this.options.step:1,c=(b-this._valueMin())%a;return alignValue=b-c,2*Math.abs(c)>=a&&(alignValue+=c>0?a:-a),parseFloat(alignValue.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var f,g,i,j,l,b=this.options.range,a=this.options,c=this,e=!this._animateOff&&a.animate,h={};this.options.values&&this.options.values.length?this.handles.each(function(k){f=(c.values(k)-c._valueMin())/(c._valueMax()-c._valueMin())*100,h["horizontal"===c.orientation?"left":"bottom"]=f+"%",d(this).stop(1,1)[e?"animate":"css"](h,a.animate),c.options.range===!0&&("horizontal"===c.orientation?(0===k&&c.range.stop(1,1)[e?"animate":"css"]({left:f+"%"},a.animate),1===k&&c.range[e?"animate":"css"]({width:f-g+"%"},{queue:!1,duration:a.animate})):(0===k&&c.range.stop(1,1)[e?"animate":"css"]({bottom:f+"%"},a.animate),1===k&&c.range[e?"animate":"css"]({height:f-g+"%"},{queue:!1,duration:a.animate}))),g=f}):(i=this.value(),j=this._valueMin(),l=this._valueMax(),f=l!==j?(i-j)/(l-j)*100:0,h["horizontal"===c.orientation?"left":"bottom"]=f+"%",this.handle.stop(1,1)[e?"animate":"css"](h,a.animate),"min"===b&&"horizontal"===this.orientation&&this.range.stop(1,1)[e?"animate":"css"]({width:f+"%"},a.animate),"max"===b&&"horizontal"===this.orientation&&this.range[e?"animate":"css"]({width:100-f+"%"},{queue:!1,duration:a.animate}),"min"===b&&"vertical"===this.orientation&&this.range.stop(1,1)[e?"animate":"css"]({height:f+"%"},a.animate),"max"===b&&"vertical"===this.orientation&&this.range[e?"animate":"css"]({height:100-f+"%"},{queue:!1,duration:a.animate}))}}),d.extend(d.ui.slider,{version:"1.8.11"})}($jQ),function($){function install(el,opts){var full=el==window,msg=opts&&void 0!==opts.message?opts.message:void 0;opts=$.extend({},$.blockUI.defaults,opts||{}),opts.overlayCSS=$.extend({},$.blockUI.defaults.overlayCSS,opts.overlayCSS||{});var css=$.extend({},$.blockUI.defaults.css,opts.css||{}),themedCSS=$.extend({},$.blockUI.defaults.themedCSS,opts.themedCSS||{});if(msg=void 0===msg?opts.message:msg,full&&pageBlock&&remove(window,{fadeOut:0}),msg&&"string"!=typeof msg&&(msg.parentNode||msg.jquery)){var node=msg.jquery?msg[0]:msg,data={};$(el).data("blockUI.history",data),data.el=node,data.parent=node.parentNode,data.display=node.style.display,data.position=node.style.position,data.parent&&data.parent.removeChild(node)}var lyr3,s,z=opts.baseZ,lyr1=$($.browser.msie||opts.forceIframe?'<iframe class="blockUI" style="z-index:'+z++ +';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+opts.iframeSrc+'"></iframe>':'<div class="blockUI" style="display:none"></div>'),lyr2=$(opts.theme?'<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+z++ +';display:none"></div>':'<div class="blockUI blockOverlay" style="z-index:'+z++ +';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');s=opts.theme&&full?'<div class="blockUI '+opts.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+z+';display:none;position:fixed"><div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||" ")+'</div><div class="ui-widget-content ui-dialog-content"></div></div>':opts.theme?'<div class="blockUI '+opts.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+z+';display:none;position:absolute"><div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||" ")+'</div><div class="ui-widget-content ui-dialog-content"></div></div>':full?'<div class="blockUI '+opts.blockMsgClass+' blockPage" style="z-index:'+z+';display:none;position:fixed"></div>':'<div class="blockUI '+opts.blockMsgClass+' blockElement" style="z-index:'+z+';display:none;position:absolute"></div>',lyr3=$(s),msg&&(opts.theme?(lyr3.css(themedCSS),lyr3.addClass("ui-widget-content")):lyr3.css(css)),opts.theme||opts.applyPlatformOpacityRules&&$.browser.mozilla&&/Linux/.test(navigator.platform)||lyr2.css(opts.overlayCSS),lyr2.css("position",full?"fixed":"absolute"),($.browser.msie||opts.forceIframe)&&lyr1.css("opacity",0);var layers=[lyr1,lyr2,lyr3],$par=$(full?"body":el);$.each(layers,function(){this.appendTo($par)}),opts.theme&&opts.draggable&&$.fn.draggable&&lyr3.draggable({handle:".ui-dialog-titlebar",cancel:"li"});var expr=setExpr&&(!$.boxModel||$("object,embed",full?null:el).length>0);if(ie6||expr){if(full&&opts.allowBodyStretch&&$.boxModel&&$("html,body").css("height","100%"),(ie6||!$.boxModel)&&!full)var t=sz(el,"borderTopWidth"),l=sz(el,"borderLeftWidth"),fixT=t?"(0 - "+t+")":0,fixL=l?"(0 - "+l+")":0;$.each([lyr1,lyr2,lyr3],function(i,o){var s=o[0].style;if(s.position="absolute",i<2)full?s.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - ($jQ.boxModel?0:"+opts.quirksmodeOffsetHack+') + "px"'):s.setExpression("height",'this.parentNode.offsetHeight + "px"'),full?s.setExpression("width",'$jQ.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):s.setExpression("width",'this.parentNode.offsetWidth + "px"'),fixL&&s.setExpression("left",fixL),fixT&&s.setExpression("top",fixT);else if(opts.centerY)full&&s.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"'),s.marginTop=0;else if(!opts.centerY&&full){var top=opts.css&&opts.css.top?parseInt(opts.css.top):0,expression="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+top+') + "px"';s.setExpression("top",expression)}})}if(msg&&(opts.theme?lyr3.find(".ui-widget-content").append(msg):lyr3.append(msg),(msg.jquery||msg.nodeType)&&$(msg).show()),($.browser.msie||opts.forceIframe)&&opts.showOverlay&&lyr1.show(),opts.fadeIn){var cb=opts.onBlock?opts.onBlock:noOp,cb1=opts.showOverlay&&!msg?cb:noOp,cb2=msg?cb:noOp;opts.showOverlay&&lyr2._fadeIn(opts.fadeIn,cb1),msg&&lyr3._fadeIn(opts.fadeIn,cb2)}else opts.showOverlay&&lyr2.show(),msg&&lyr3.show(),opts.onBlock&&opts.onBlock();if(bind(1,el,opts),full?(pageBlock=lyr3[0],pageBlockEls=$(":input:enabled:visible",pageBlock),opts.focusInput&&setTimeout(focus,20)):center(lyr3[0],opts.centerX,opts.centerY),opts.timeout){var to=setTimeout(function(){full?$.unblockUI(opts):$(el).unblock(opts)},opts.timeout);$(el).data("blockUI.timeout",to)}}function remove(el,opts){var full=el==window,$el=$(el),data=$el.data("blockUI.history"),to=$el.data("blockUI.timeout");to&&(clearTimeout(to),$el.removeData("blockUI.timeout")),opts=$.extend({},$.blockUI.defaults,opts||{}),bind(0,el,opts);var els;els=full?$("body").children().filter(".blockUI").add("body > .blockUI"):$(".blockUI",el),full&&(pageBlock=pageBlockEls=null),opts.fadeOut?(els.fadeOut(opts.fadeOut),setTimeout(function(){reset(els,data,opts,el)},opts.fadeOut)):reset(els,data,opts,el)}function reset(els,data,opts,el){els.each(function(i,o){this.parentNode&&this.parentNode.removeChild(this)}),data&&data.el&&(data.el.style.display=data.display,data.el.style.position=data.position,data.parent&&data.parent.appendChild(data.el),$(el).removeData("blockUI.history")),"function"==typeof opts.onUnblock&&opts.onUnblock(el,opts)}function bind(b,el,opts){var full=el==window,$el=$(el);if((b||(!full||pageBlock)&&(full||$el.data("blockUI.isBlocked")))&&(full||$el.data("blockUI.isBlocked",b),opts.bindEvents&&(!b||opts.showOverlay))){var events="mousedown mouseup keydown keypress";b?$(document).bind(events,opts,handler):$(document).unbind(events,handler)}}function handler(e){if(e.keyCode&&9==e.keyCode&&pageBlock&&e.data.constrainTabKey){var els=pageBlockEls,fwd=!e.shiftKey&&e.target===els[els.length-1],back=e.shiftKey&&e.target===els[0];if(fwd||back)return setTimeout(function(){focus(back)},10),!1}var opts=e.data;return $(e.target).parents("div."+opts.blockMsgClass).length>0||0==$(e.target).parents().children().filter("div.blockUI").length}function focus(back){if(pageBlockEls){var e=pageBlockEls[back===!0?pageBlockEls.length-1:0];e&&e.focus()}}function center(el,x,y){var p=el.parentNode,s=el.style,l=(p.offsetWidth-el.offsetWidth)/2-sz(p,"borderLeftWidth"),t=(p.offsetHeight-el.offsetHeight)/2-sz(p,"borderTopWidth");x&&(s.left=l>0?l+"px":"0"),y&&(s.top=t>0?t+"px":"0")}function sz(el,p){return parseInt($.css(el,p))||0}if(/1\.(0|1|2)\.(0|1|2)/.test($.fn.jquery)||/^1.1/.test($.fn.jquery))return void alert("blockUI requires jQuery v1.2.3 or later!  You are using v"+$.fn.jquery);$.fn._fadeIn=$.fn.fadeIn;var noOp=function(){},mode=document.documentMode||0,setExpr=$.browser.msie&&($.browser.version<8&&!mode||mode<8),ie6=$.browser.msie&&/MSIE 6.0/.test(navigator.userAgent)&&!mode;$.blockUI=function(opts){install(window,opts)},$.unblockUI=function(opts){remove(window,opts)},$.growlUI=function(title,message,timeout,onClose){var $m=$('<div class="growlUI"></div>');title&&$m.append("<h1>"+title+"</h1>"),message&&$m.append("<h2>"+message+"</h2>"),void 0==timeout&&(timeout=3e3),$.blockUI({message:$m,fadeIn:700,fadeOut:1e3,centerY:!1,timeout:timeout,showOverlay:!1,onUnblock:onClose,css:$.blockUI.defaults.growlCSS})},$.fn.block=function(opts){return this.unblock({fadeOut:0}).each(function(){"static"==$.css(this,"position")&&(this.style.position="relative"),$.browser.msie&&(this.style.zoom=1),install(this,opts)})},$.fn.unblock=function(opts){return this.each(function(){remove(this,opts)})},$.blockUI.version=2.38,$.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:!0,theme:!1,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:.6,cursor:"wait"},growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:!1,baseZ:1e3,centerX:!0,centerY:!0,allowBodyStretch:!0,bindEvents:!0,constrainTabKey:!0,fadeIn:200,fadeOut:400,timeout:0,showOverlay:!0,focusInput:!0,applyPlatformOpacityRules:!0,onBlock:null,onUnblock:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg"};var pageBlock=null,pageBlockEls=[]}($jQ),/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 20112014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
!function(a){function f(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var e,b=a.ui.mouse.prototype,c=b._mouseInit,d=b._mouseDestroy;b._touchStart=function(a){var b=this;!e&&b._mouseCapture(a.originalEvent.changedTouches[0])&&(e=!0,b._touchMoved=!1,f(a,"mouseover"),f(a,"mousemove"),f(a,"mousedown"))},b._touchMove=function(a){e&&(this._touchMoved=!0,f(a,"mousemove"))},b._touchEnd=function(a){e&&(f(a,"mouseup"),f(a,"mouseout"),this._touchMoved||f(a,"click"),e=!1)},b._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),c.call(b)},b._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),d.call(b)}}}($jQ),websight.sooqr.ResultsPanel=function(controllerInstance,parameters){this._name="ResultsPanel",this.controllerInstance=controllerInstance,this.container=this.controllerInstance.container,this.resultContainer=null,this.parameters=parameters,this.persistentParameters={sortBy:""},this.showMoreButton=null,this.moreResultsLoader=null,this.resultOffset=0,this.lastResultParameters={},this.lastSuccessfulResultParameters={},this.lastScrollPosition=null,this.addResultsOnScroll="addResultsOnScroll"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.addResultsOnScroll,this.setPersistentParameters=function(parameters){var options=["sortBy","viewType"];for(k in options)options[k]in parameters&&(this.persistentParameters[options[k]]=parameters[options[k]])},this.updateResults=function(parameters){if(this.toggleMoreResultsLoader(!1),this.lastResultParameters=parameters,this.resultContainer=null,parameters.numberOfResults&&(this.lastSuccessfulResultParameters=parameters),null!=parameters.resultsPanel.resultOffset&&parameters.resultsPanel.resultOffset>0){var newResultHtml=$jQ('<div class="sooqrSearchResults">'+parameters.resultsPanel.html+"</div>"),newResults=$jQ("div.results, .sqr-results",newResultHtml[0]);this.addClickEvents(newResults.children(),parameters.resultsPanel),this.resultContainer=$jQ("div.sooqrSearchResultsContainer div.sooqrSearchResults",this.container),this.resultContainer.find("div.results, .sqr-results").append(newResults.children())}else this.resultOffset=0,this.resultContainer=$jQ("div.sooqrSearchResultsContainer div.sooqrSearchResults",this.container),controllerInstance.needResultsRender(parameters)&&this.resultContainer.html(parameters.resultsPanel.html),$jQ("div.options div.views ul li, div.sqr-options div.sqr-views ul li",this.resultContainer).click($jQ.proxy(this.handleViewClick,this)),"disableCustomSort"in this.controllerInstance.indexSettings.view&&0!=this.controllerInstance.indexSettings.view.disableCustomSort||$jQ('div.sort select[name="sortby"], div.sqr-sort select[name="sortby"]',this.container).selectbox({effect:"fade",onOpen:function(inst){$jQ("#"+inst.settings.classHolder+"_"+inst.uid).toggleClass(inst.settings.classHolder+"Open",inst.isOpen);var activeOption=$jQ("#"+inst.settings.classOptions+"_"+inst.uid).find('a[rel="'+inst.input.val()+'"]').parent();activeOption.siblings().removeClass("sbActive"),activeOption.addClass("sbActive")},onClose:function(inst){$jQ("#"+inst.settings.classHolder+"_"+inst.uid).toggleClass(inst.settings.classHolder+"Open",inst.isOpen)}}),$jQ('select[name="sortby"]',this.container).bind("change",$jQ.proxy(this.handleSortChange,this)),$jQ('ul[class="sortby"] a, ul[class="sqr-sortby"] a',this.container).bind("click",$jQ.proxy(this.handleSortClick,this)),parameters.numberOfResults>0&&(this.addClickEvents($jQ("div .results div.resultItem",this.resultsContainer),parameters.resultsPanel),this.addClickEvents($jQ("div .sqr-results .sqr-resultItem",this.resultsContainer),parameters.resultsPanel));"headerHtml"in parameters.resultsPanel?this.container.find("div.sooqrSearchHeader").html(parameters.resultsPanel.headerHtml).show():this.container.find("div.sooqrSearchHeader").hide(),"footerHtml"in parameters.resultsPanel?this.container.find("div.sooqrSearchFooter").html(parameters.resultsPanel.footerHtml).show():this.container.find("div.sooqrSearchFooter").hide(),$jQ(".closeButton, .sqr-closeButton, .sqr-mobile-bottom-close-button",this.container).bind("click",$jQ.proxy(function(event){this.controllerInstance.hideContainer()},this)),$jQ(".sqr-mobile-bottom-up-button",this.container).bind("click",function(){$jQ("html, body").animate({scrollTop:0},1e3)}),this.toggleShowMoreButton(parameters.resultsPanel.resultsInResponse+parameters.resultsPanel.resultOffset<parameters.numberOfResults,parameters.numberOfResults,parameters.numberOfResults),parameters.numberOfResults>0&&this.updateResultsCounter(parameters.numberOfResults),this.updateResultNotifier(),this.addResultsOnScroll&&$jQ(window).unbind("scroll",this.moreResultsScrollHandler).bind("scroll",this.moreResultsScrollHandler),this.controllerInstance.indexSettings.view.cssVersion>=4&&($jQ(window).unbind("scroll",this.optionBarScrollHandler).bind("scroll",this.optionBarScrollHandler),this.handleOptionBarWindowScroll()),"mobileBottomButton"in this.controllerInstance.indexSettings.view&&1!=this.controllerInstance.indexSettings.view.mobileBottomButton||($jQ(window).unbind("scroll",this.mobileBottomButtonsScrollHandler).bind("scroll",this.mobileBottomButtonsScrollHandler),this.handleMobileBottomButtonsWindowScroll())},this.handleViewClick=function(event){var viewObject=$jQ(event.target),currentView=$jQ("li.active, li.sqr-active",viewObject.closest("ul"));currentView.length&&($jQ("div.results, .sqr-results",this.resultContainer).removeClass(currentView.attr("rel")+" sqr-"+currentView.attr("rel")),currentView.removeClass("active").removeClass("sqr-active")),viewObject.addClass("active sqr-active"),$jQ("div.results, .sqr-results",this.resultContainer).addClass(viewObject.attr("rel")+" sqr-"+viewObject.attr("rel")),this.persistentParameters.viewType=viewObject.attr("rel"),$jQ(this.controllerInstance).trigger("viewTypeChanged",[viewObject.attr("rel")])},this.handleMoreResultsWindowScroll=function(event){if($jQ(this.controllerInstance.container).is(":hidden")||null==this.showMoreButton)return!1;if($jQ(this.resultContainer).find("div.sqr-out-of-view").hide(),this.lastResultParameters.resultsPanel.resultsInResponse+Math.max(0,this.lastResultParameters.resultsPanel.resultOffset)<this.lastResultParameters.resultsPanel.numberOfResults){var scrollTop=websight.util.getWindowScrollTop(),bottomOfPanel=Math.floor(this.resultContainer.height()+this.container.offset().top);scrollTop+$jQ(window).height()>=.8*bottomOfPanel&&this.lastScrollPosition!=scrollTop+$jQ(window).height()&&(this.lastScrollPosition=scrollTop+$jQ(window).height(),$jQ(window).unbind("scroll",this.moreResultsScrollHandler),this.loadMoreResults())}},this.moreResultsScrollHandler="function"==typeof websight.util.debounce?websight.util.debounce($jQ.proxy(this.handleMoreResultsWindowScroll,this),100):$jQ.proxy(this.handleMoreResultsWindowScroll,this),this.handleOptionBarWindowScroll=function(event){var sqrOptions=$jQ("div.sqr-options",this.resultContainer),scrollTop=websight.util.getWindowScrollTop(),isFixed=sqrOptions.hasClass("sqr-fixed"),sqrOptionsTop=sqrOptions.offset()?sqrOptions.offset().top:0,sqrOptionsOrigTop=sqrOptions.data("sqr-original-top");scrollTop>sqrOptionsTop+100&&!isFixed?(sqrOptions.data("sqr-original-top",sqrOptionsTop),sqrOptions.css({width:sqrOptions.outerWidth()+"px","z-index":this.controllerInstance.parameters.zIndex+1,"margin-left":-$jQ(window).scrollLeft()+"px"}).addClass("sqr-fixed")):scrollTop<=sqrOptionsOrigTop&&isFixed&&sqrOptions.css("width","").removeClass("sqr-fixed")},this.optionBarScrollHandler="function"==typeof websight.util.debounce?websight.util.debounce($jQ.proxy(this.handleOptionBarWindowScroll,this),100):$jQ.proxy(this.handleOptionBarWindowScroll,this),this.addClickEvents=function(objectsToTrack,parameters){return null!=this.controllerInstance.addClickEvents?$jQ.proxy(this.controllerInstance.addClickEvents,this.controllerInstance)(objectsToTrack,parameters):void $jQ.each(objectsToTrack,$jQ.proxy(function(index,value){if(1==this.controllerInstance.indexSettings.view.enableResultitemClick){var url=$jQ("a",value).not(".custom-link").attr("href");$jQ(value).bind("click",$jQ.proxy(function(event){var resultItem=$jQ(event.currentTarget).closest(".resultItem, .sqr-resultItem"),resultId=resultItem.data("id"),titleLink=$jQ('a[rel="title"]',resultItem),resultTitle=titleLink.attr("title");return"enableBackButton"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.enableBackButton&&this.controllerInstance.searchCallback.saveBackButtonParameters(),this.trackClick(url,parameters.resultOffset+index+1,resultId,resultTitle),event.preventDefault(),event.stopPropagation(),!1},this))}$jQ("a",value).not(".custom-link").bind("click",$jQ.proxy(function(event){var resultTitle,resultItem=$jQ(event.currentTarget).closest(".resultItem, .sqr-resultItem"),titleLink=$jQ('a[rel="title"]',resultItem),resultId=resultItem.data("id");resultTitle=titleLink.attr("title")?titleLink.attr("title"):titleLink.text(),"enableBackButton"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.enableBackButton&&this.controllerInstance.searchCallback.saveBackButtonParameters(),this.trackClick(event.currentTarget.href,parameters.resultOffset+index+1,resultId,resultTitle),event.preventDefault(),event.stopPropagation()},this))},this))},this.changeSort=function(sortBy){this.persistentParameters.sortBy=sortBy,this.controllerInstance.searchCallback.directCallback({sortBy:this.persistentParameters.sortBy,filterInitiated:!0})},this.handleSortChange=function(){this.changeSort($jQ('select[name="sortby"]',this.container).val())},this.handleSortClick=function(event){return this.changeSort($jQ(event.target).attr("rel")),event.preventDefault(),!1},this.updateResultsCounter=function(numberOfResults){$jQ("div.numberOfResults",this.container).html(numberOfResults+" resultaten")},this.toggleShowMoreButton=function(state){this.showMoreButton=$jQ("a.moreResults, a.sqr-moreResults",this.container),this.showMoreButton.length>0&&(this.showMoreButton.unbind("click",$jQ.proxy(this.loadMoreResults,this)),this.showMoreButton.bind("click",$jQ.proxy(this.loadMoreResults,this)),this.showMoreButton.css("display",state?"block":"none"))},this.toggleMoreResultsLoader=function(state){this.moreResultsLoader=$jQ("div.moreResultsLoader",this.container),this.moreResultsLoader.length>0&&this.moreResultsLoader.css("display",state?"block":"none")},this.trackClick=function(url,resultIndex,resultId,resultTitle){this.controllerInstance.searchCallback.tracker&&this.controllerInstance.tracking?this.controllerInstance.searchCallback.tracker._trackResultClick(this.controllerInstance.getQueryText(),this.controllerInstance.searchCallback.requestId,this.controllerInstance.searchCallback.requestIndex,resultIndex,this.lastResultParameters.numberOfResults,resultId,resultTitle,url,$jQ.proxy(function(){$jQ(this.controllerInstance).trigger("click",[url,resultIndex,resultId,resultTitle])},this)):$jQ(this.controllerInstance).trigger("click",[url,resultIndex,resultId,resultTitle])},this.loadMoreResults=function(){return this.resultOffset+=this.lastResultParameters.resultsPanel.resultsInResponse,this.toggleShowMoreButton(!1),this.toggleMoreResultsLoader(!0),this.controllerInstance.searchCallback.directCallback({offset:this.resultOffset,filterInitiated:!0}),!1},this.updateResultNotifier=function(){var container=$jQ(this.resultContainer),offset=container.offset(),bottom=offset.top+container.height(),outOfView=bottom>0&&websight.util.getWindowScrollTop()>0&&bottom<websight.util.getWindowScrollTop();if(outOfView){container.css("position","relative");var text=this.lastResultParameters.resultsPanel.outOfViewText;if(0==$jQ("div.sqr-out-of-view",container).length){var controllerInstance=this.controllerInstance;container.append('<div class="sqr-out-of-view sooqrOutOfView"><span>'+text+"</span></div>"),$jQ("div.sqr-out-of-view",container).bind("click",function(event){return $jQ("html, body").animate({scrollTop:0},"fast"),$jQ(this).closest("div.sqr-out-of-view").hide(),controllerInstance.updateMinimumHeight(),event.preventDefault(),!1})}else $jQ("div.sqr-out-of-view span",container).html(text);var outOfViewContainer=$jQ("div.sqr-out-of-view",container),outOfViewContainerTop=websight.util.getWindowScrollTop()-offset.top+(Math.floor($jQ(window).height()/2)-Math.floor(outOfViewContainer.height()/2));outOfViewContainer.css({"position":"absolute","left":Math.round(container.width()/2)-Math.floor(outOfViewContainer.width()/2)+"px","top":Math.floor(outOfViewContainerTop)+"px"})}else $jQ("div.sqr-out-of-view",container).hide(),container.css("position","none")},this.getContainerHeight=function(){return this.resultContainer?this.resultContainer.find(".sqr-results").height():0},this.toggleMoreResultsLoaderCallback=function(state){this.addResultsOnScroll&&(state?$jQ(window).unbind("scroll",this.moreResultsScrollHandler).bind("scroll",this.moreResultsScrollHandler):$jQ(window).unbind("scroll",this.moreResultsScrollHandler))},this.translateWordsSetByJavascript=function(parameters){void 0!=parameters.translations&&($jQ("#sooqrSearchMobileTabsResultsText",this.container).html(void 0!=parameters.translations.results?parameters.translations.results:"Resultaten"),$jQ("#sooqrSearchMobileTabsFiltersText",this.container).html(void 0!=parameters.translations.filters?parameters.translations.filters:"Filteren"))},this.handleMobileBottomButtonsWindowScroll=function(event){var sqrMobileBottomButtons=$jQ(".sqr-mobile-bottom-button");if(!sqrMobileBottomButtons.length)return!1;var scrollTop=websight.util.getWindowScrollTop(),sqrMobileBottomButtonsTop=this.resultContainer.offset().top,sqrIsMobileBottomButtonsVisible=sqrMobileBottomButtons.is(":visible");scrollTop>sqrMobileBottomButtonsTop&&!sqrIsMobileBottomButtonsVisible?sqrMobileBottomButtons.fadeIn():scrollTop<=sqrMobileBottomButtonsTop&&sqrIsMobileBottomButtonsVisible&&sqrMobileBottomButtons.fadeOut()},this.mobileBottomButtonsScrollHandler="function"==typeof websight.util.debounce?websight.util.debounce($jQ.proxy(this.handleMobileBottomButtonsWindowScroll,this),100):$jQ.proxy(this.handleMobileBottomButtonsWindowScroll,this)},websight.sooqr.SearchCallback=function(controllerInstance){this.delay=300,this.requestIndex=-1,this.requestId=null,this.scrollAfterRequest=null,this.timeoutHandle=null,this.inputField=null,this.controllerInstance=controllerInstance,this.filterPanel=null,this.resultsPanel=null,this.previousQueryParameters=null,this.queryParametersHistory=[],this.tracker=new websight.sooqr.Tracker(this.controllerInstance),this.tracker._setIndex(this.controllerInstance.parameters.index,this.controllerInstance.parameters.view),this.tracker._setAccount(this.controllerInstance.parameters.account),this.parameters=this.controllerInstance.getParameters(),this.delayedCallback=function(additionalParameters,inputField){this.clearTimeout(),void 0==additionalParameters&&(additionalParameters={}),this.controllerInstance.indexSettings.view.keypressDelay&&(this.delay=this.controllerInstance.indexSettings.view.keypressDelay),this.timeoutHandle=setTimeout($jQ.proxy(function(){this.callback(additionalParameters,inputField)},this),this.delay)},this.directCallback=function(additionalParameters){this.clearTimeout(),void 0==additionalParameters&&(additionalParameters={}),this.timeoutHandle=setTimeout($jQ.proxy(function(){this.callback(additionalParameters)},this),0)},this.clearTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},this.callback=function(queryParameters,inputField){this.clearTimeout(),this.queryParameters=queryParameters,"undefined"==typeof inputField&&"queryField"in this.controllerInstance?this.inputField=this.controllerInstance.queryField:this.inputField=inputField;var searchQuery=this.controllerInstance.getSearchQuery(this.inputField);if((null==searchQuery||0==searchQuery.length)&&"Filter"!=this.controllerInstance.objectName){if(!("allowEmptyQuery"in this.controllerInstance.indexSettings.view&&0!=this.controllerInstance.indexSettings.view.allowEmptyQuery))return void this.controllerInstance.hideContainer();searchQuery=""}this.enableLoaderIcon();var filterQuery=null;if(this.filterPanel&&(void 0!=queryParameters.filterInitiated&&1==queryParameters.filterInitiated?filterQuery=this.filterPanel.toArray():queryParameters.filtersShowAll||this.filterPanel.clearLastFilterQuery()),queryParameters.filterInitiated||(filterQuery=this.controllerInstance.appendDefaultFilters(filterQuery)),filterQuery=this.controllerInstance.appendFixedFilters(filterQuery),this.filterPanel){filterParameters=this.filterPanel.persistentParameters;for(var k in filterParameters)queryParameters[k]=filterParameters[k]}if(filterQuery=this.controllerInstance.appendSecuredFilters(filterQuery),queryParameters=this.controllerInstance.appendSecuredFiltersParameters(queryParameters),queryParameters=this.controllerInstance.appendDynamicFieldsParameters(queryParameters),this.resultsPanel)for(var k in this.resultsPanel.persistentParameters)queryParameters[k]=this.resultsPanel.persistentParameters[k];this.sendSearchQuery(searchQuery,filterQuery,queryParameters)},this.sendSearchQuery=function(searchQuery,filterQuery,queryParameters){void 0==queryParameters.sortBy&&(queryParameters.sortBy=0),void 0==queryParameters.offset&&(queryParameters.offset=0),void 0==queryParameters.filterInitiated&&(queryParameters.filterInitiated=!1),void 0==queryParameters.triggerFilter&&(queryParameters.triggerFilter=null),void 0==queryParameters.filtersShowAll&&(queryParameters.filtersShowAll=!1),void 0==queryParameters.enableFiltersShowAll&&(queryParameters.enableFiltersShowAll=!1),void 0==queryParameters.filterValuesShowAll&&(queryParameters.filterValuesShowAll=null),void 0==queryParameters.securedFiltersHash&&(queryParameters.securedFiltersHash=!1),void 0==queryParameters.locale&&(queryParameters.locale=this.parameters.locale||websight.util.getLanguage()),null!=this.previousQueryParameters?null==searchQuery||searchQuery.match(new RegExp("^"+websight.util.regexpEscape(this.previousQueryParameters.searchQuery),"i"))||(this.requestId=websight.util.randomNumber(),this.requestIndex=-1):this.requestId=websight.util.randomNumber(),this.requestIndex++,this.previousQueryParameters=queryParameters,this.previousQueryParameters.searchQuery=searchQuery,this.previousQueryParameters.filterQuery=filterQuery,this.queryParametersHistory.push(this.previousQueryParameters),this.queryParametersHistory=this.queryParametersHistory.slice(-10),$jQ(this.controllerInstance).trigger("sendSearchQuery",[searchQuery,filterQuery,queryParameters]),"enableHash"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.enableHash&&this.serializeSearchToHash(),null!=this.controllerInstance.indexSettings.connection.proxy?this.sendSearchQueryByProxy(searchQuery,filterQuery,queryParameters):this.sendSearchQueryByScript(searchQuery,filterQuery,queryParameters)},this.saveBackButtonParameters=function(){var queryParameters=this.getQueryParameters(),data={"u":window.location.href,"q":queryParameters,"p":this.controllerInstance.getParameters()};data.p.scrollAfterRequest=websight.util.getWindowScrollTop();var newCookie="__sqrlq="+escape(JSON.stringify(data));newCookie+="; Path=/",newCookie+="; Domain=."+websight.util.removeWww(window.location.hostname),newCookie+="; Max-Age=300",document.cookie=newCookie},this.sendSearchQueryByProxy=function(searchQuery,filterQuery,queryParameters){$jQ.ajax(this.controllerInstance.indexSettings.connection.proxy,{async:!0,complete:this.sendSearchQueryByProxyCompleted,context:this,dataType:"json",data:this.buildSearchQuery(searchQuery,filterQuery,queryParameters),type:"POST"})},this.sendSearchQueryByScript=function(searchQuery,filterQuery,queryParameters){var dynamicScriptUrl=document.location.protocol+"//"+this.controllerInstance.indexSettings.connection.server+"/"+this.controllerInstance.getApiMethod()+"/script/?",queryData=this.buildSearchQuery(searchQuery,filterQuery,queryParameters);$jQ.getScript(dynamicScriptUrl+$jQ.param(queryData))},this.buildSearchQuery=function(searchQuery,filterQuery,queryParameters){var data={"type":this.controllerInstance.objectName.toLowerCase(),"searchQuery":searchQuery,"filterQuery":filterQuery,"filterInitiated":queryParameters.filterInitiated,"triggerFilter":queryParameters.triggerFilter,"filtersShowAll":queryParameters.filtersShowAll,"enableFiltersShowAll":queryParameters.enableFiltersShowAll,"filterValuesShowAll":queryParameters.filterValuesShowAll,"securedFiltersHash":queryParameters.securedFiltersHash,"sortBy":queryParameters.sortBy,"offset":queryParameters.offset,"limit":queryParameters.limit?queryParameters.limit:this.controllerInstance.indexSettings.view.resultsPerPage,"requestIndex":this.requestIndex,"locale":queryParameters.locale,"url":window.location.pathname};return this.controllerInstance.tracking&&(data.sid=[websight.util.domainHash(),this.tracker.getVisitorId(),this.tracker.initialVisit,this.tracker.previousSession,this.tracker.currentSession,this.tracker.sessionCount].join(".")),"viewType"in queryParameters&&(data.viewType=queryParameters.viewType),"dynamicFields"in queryParameters&&(data.dynamicFields=queryParameters.dynamicFields),this.parameters.index&&(data.index=this.parameters.index),this.parameters.view&&(data.view=this.parameters.view),this.parameters.account&&(data.account=this.parameters.account),data},this.sendSearchQueryByScriptCompleted=function(result){this.disableLoaderIcon(),this.processSearchQueryResult(result)},this.sendSearchQueryByProxyCompleted=function(httpObject,status){if(this.disableLoaderIcon(),0==httpObject.responseText.length)return void this.controllerInstance.hideContainer();try{var fullResult=$jQ.parseJSON(httpObject.responseText);result=fullResult.sooqr}catch(e){return websight.sooqr.Debug.log(e),!1}this.processSearchQueryResult(result,fullResult)},this.compareFilters=function(filters1,filters2){for(var id in filters1){var values=filters1[id];for(i in values)if(void 0!==filters2[id]&&filters2[id].indexOf(values[i])===-1)return!1}return!0},this.processSearchQueryResult=function(result,fullResult){var query=result.searchQuery,filters=[];for(var i in result.filtersPanel.filters){var filter=result.filtersPanel.filters[i];for(fI in filter.values){var value=filter.values[fI];value.a===!0&&(void 0===filters[filter.id]&&(filters[filter.id]=[]),filters[filter.id].push(value.l))}}for(var i=this.queryParametersHistory.length-1;i>=0;i--){var queryParameters=this.queryParametersHistory[i];if(this.compareFilters(filters,queryParameters.filterQuery)&&query==queryParameters.searchQuery){this.queryParametersHistory[i].numberOfResults=result.numberOfResults;break}}if(result.resultsPanel&&result.resultsPanel.enabled&&null==this.resultsPanel&&websight.sooqr.ResultsPanel&&(this.resultsPanel=new websight.sooqr.ResultsPanel(this.controllerInstance),this.resultsPanel.setPersistentParameters(this.previousQueryParameters)),!("requestIndex"in result&&parseInt(result.requestIndex)<this.requestIndex)){if("error"==result.status&&result.statusMessage)return websight.util.log(result.statusMessage),!1;this.controllerInstance.tracking&&(0==this.previousQueryParameters.filterInitiated?this.tracker._trackQuery(this.previousQueryParameters.searchQuery,result.numberOfResults,this.requestId,this.requestIndex):this.tracker._trackFilter(this.previousQueryParameters.searchQuery,result.numberOfResults,this.requestId,this.requestIndex));var hasCustomTemplate=result.custom&&result.custom.enabled;if(hasCustomTemplate){$jQ(this.controllerInstance.container).children("div").not(".sooqrSearchOptionsMobile").hide(),this.controllerInstance.container.addClass("sqr-custom"),this.controllerInstance.container.append('<div class="sooqrCustom">'+result.custom.html+"</div>"),$jQ(".sooqrSearchMobileTabs",this.controllerInstance.container).css("visibility","hidden");var queryParametersHistoryHasResults=!1;for(var i in this.queryParametersHistory)if(this.queryParametersHistory[i].numberOfResults>0){queryParametersHistoryHasResults=!0;break}return $jQ(".sqr-has-previous-query",this.controllerInstance.container).toggle(queryParametersHistoryHasResults),$jQ('a[rel="load-last-query"]',this.controllerInstance.container).toggle(queryParametersHistoryHasResults).click($jQ.proxy(function(event){event.preventDefault(),this.reloadLastQuery()},this)),$jQ(".closeButton, .sqr-closeButton",this.controllerInstance.container).bind("click",$jQ.proxy(function(event){this.controllerInstance.hideContainer()},this)),void this.controllerInstance.showContainer()}if($jQ("div.sooqrCustom").length){$jQ(".sooqrSearchMobileTabs",this.controllerInstance.container).css("visibility","visible"),$jQ("div.sooqrCustom",this.controllerInstance.container).remove(),this.controllerInstance.container.removeClass("sqr-custom").children("div").not(".sooqrSearchOptionsMobile").show();var $optionsMobile=$jQ(".sooqrSearchOptionsMobile",this.container),$filtersContainer=$jQ(".sooqrSearchFilters",this.container),windowWidth=$jQ(window).width();windowWidth<this.controllerInstance.indexSettings.view.responsiveMobileWidth&&this.activeResponsiveWidth!=this.controllerInstance.indexSettings.view.responsiveMobileWidth&&$jQ(".sooqrSearchMobileTabsResults",$optionsMobile).hasClass("sooqrSearchMobileTabsActive")&&$filtersContainer.hide()}if(0==result.numberOfResults)return result.filtersPanel&&result.filtersPanel.enabled&&this.filterPanel&&(result.filterInitiated?this.filterPanel.updateFilters(result.filtersPanel,this.previousQueryParameters):this.filterPanel.togglePanel(!1)),result.resultsPanel&&result.resultsPanel.enabled&&this.resultsPanel&&(this.resultsPanel.updateResults(result),this.controllerInstance.showContainer()),void $jQ(this.controllerInstance).trigger("queryResultProcessed",[fullResult]);if(result.resultsPanel.enabled&&this.resultsPanel&&!result.filtersPanel.enableFiltersShowAll&&(this.resultsPanel.updateResults(result),this.controllerInstance.showContainer(),$jQ(this.controllerInstance).trigger("updateResults",[fullResult])),result.filtersPanel.enabled){if(null==this.filterPanel)this.filterPanel=new websight.sooqr.FilterPanel(this.controllerInstance,result.filtersPanel,this.previousQueryParameters.filterQuery);else if(this.filterPanel.togglePanel(!0),result.filterInitiated)if(result.filtersPanel.enableFiltersShowAll)this.filterPanel.showHiddenFilters(result.filtersPanel);else{var previousQueryParameters=this.previousQueryParameters;$jQ.proxy(function(){this.updateFilters(result.filtersPanel,previousQueryParameters)},this.filterPanel)()}else $jQ.proxy(function(){this.initializePanel(result.filtersPanel)},this.filterPanel)();$jQ(this.controllerInstance).trigger("updateFilters",[fullResult])}if(result.experimentId?this.tracker.setExperimentId(result.experimentId):this.tracker.setExperimentId(null),this.controllerInstance.indexSettings.view.cssVersion>=4&&(this.controllerInstance.handleResponsiveResize(),this.resultsPanel.translateWordsSetByJavascript(result)),$jQ(".sqrSearchResultCounter",this.controllerInstance.container).text(result.numberOfResults),$jQ(".sqrSearchResultRemainingCounter",this.controllerInstance.container).text(result.resultsRemaining),null!=this.scrollAfterRequest&&($jQ(window).trigger("scroll"),websight.util.setWindowScrollTop(this.scrollAfterRequest),this.scrollAfterRequest=null,null!=this.resultsPanel)){var outOfViewContainer=$jQ("div.sqr-out-of-view",this.resultsPanel.container);outOfViewContainer.hide()}$jQ(this.controllerInstance).trigger("queryResultProcessed",[fullResult])}},this.reloadLastQuery=function(){this.queryParametersHistory.pop();for(var queryParameters=this.queryParametersHistory.pop();this.queryParametersHistory.length>0&&(void 0==queryParameters.numberOfResults||0==queryParameters.numberOfResults);)queryParameters=this.queryParametersHistory.pop();return 0!=this.queryParametersHistory.length&&(queryParameters.filterInitiated=!0,"triggerFilter"in this.previousQueryParameters&&"location"===this.filterPanel.getFilterType(this.previousQueryParameters.triggerFilter)&&this.filterPanel.clearGeoFilter(this.previousQueryParameters.triggerFilter),this.controllerInstance.setSearchQuery(queryParameters.searchQuery),void this.sendSearchQuery(queryParameters.searchQuery,queryParameters.filterQuery,queryParameters))},this.enableLoaderIcon=function(){$jQ(this.controllerInstance).trigger("loading"),null==this.inputField||this.inputField.hasClass("sooqrQueryBoxLoading")||(this.inputField.addClass("_search_loading"),this.inputField.addClass("sooqrQueryBoxLoading"))},this.disableLoaderIcon=function(){null!=this.inputField&&this.inputField.hasClass("sooqrQueryBoxLoading")&&(this.inputField.removeClass("_search_loading"),this.inputField.removeClass("sooqrQueryBoxLoading")),$jQ(this.controllerInstance).trigger("completedLoading")},this.createAnalyticsUrl=function(url){var qparts={},needsReplace=!1;return this.controllerInstance.indexSettings.googleSearchTracking.enabled&&this.controllerInstance.indexSettings.googleSearchTracking.query_parameter&&(qparts[this.controllerInstance.indexSettings.googleSearchTracking.query_parameter]=encodeURIComponent(this.controllerInstance.getQueryText()),needsReplace=!0),this.controllerInstance.indexSettings.googleAdTracking.enabled&&(qparts.utm_source=encodeURIComponent(this.controllerInstance.indexSettings.googleAdTracking.utm_source),qparts.utm_campaign=encodeURIComponent(this.controllerInstance.indexSettings.googleAdTracking.utm_campaign),qparts.utm_medium=encodeURIComponent(this.controllerInstance.indexSettings.googleAdTracking.utm_medium),this.controllerInstance.indexSettings.googleAdTracking.utm_term&&(qparts.utm_term=encodeURIComponent(this.controllerInstance.getQueryText())),needsReplace=!0),needsReplace?websight.util.replaceQueryVars(url,qparts):url},this.getQueryParameters=function(){var queryParameters=this.previousQueryParameters;if(this.filterPanel)for(k in this.filterPanel.persistentParameters)queryParameters[k]=this.filterPanel.persistentParameters[k];if(this.resultsPanel)for(k in this.resultsPanel.persistentParameters)queryParameters[k]=this.resultsPanel.persistentParameters[k];return queryParameters},this.serializeSearchToHash=function(queryParameters){"undefined"==typeof queryParameters&&(queryParameters=this.getQueryParameters());var hashValue="#",hash=decodeURIComponent(window.location.hash);hash&&(hashValue=null!=hash.match(/sqr:\(/)?hash.replace(/[\&]?sqr:\(.+\)/,""):hash,hashValue.length>1&&(hashValue+="&"));var queryInHash="";if("searchQuery"in queryParameters&&queryParameters.searchQuery.length&&(queryInHash+="q["+encodeURIComponent(queryParameters.searchQuery)+"]"),"filterQuery"in queryParameters){var fixedFilters=this.controllerInstance.getFixedFilters();for(filterId in queryParameters.filterQuery)if(!fixedFilters.hasOwnProperty(filterId)){var values=[];for(var p in queryParameters.filterQuery[filterId])queryParameters.filterQuery[filterId].hasOwnProperty(p)&&values.push(encodeURIComponent(queryParameters.filterQuery[filterId][p]));queryInHash+=",f"+filterId+"["+values.join(",")+"]"}}if(queryInHash=queryInHash.replace(/^,/,""),queryInHash.length&&(hashValue+="sqr:("+queryInHash+")"),hashValue=hashValue.replace(/&$/,""),hashValue.length)if(window.history.replaceState)try{"#"==hashValue?window.history.replaceState("",document.title,window.location.pathname+window.location.search):window.history.replaceState(void 0,void 0,hashValue)}catch(e){window.location.replace((""+window.location).split("#")[0]+hashValue)}else window.location.replace((""+window.location).split("#")[0]+hashValue);
},this.parseSearchFromHash=function(){var lastQuery={},hash=decodeURIComponent(window.location.hash),hasMatches=!1;if(null!=(match=hash.match(/sqr:\((.+)\)/))){for(var re=/\[(.+?)\]/g;matchPart=re.exec(match[1]);)match[1]=match[1].replace(matchPart[0],matchPart[0].replace(/,/g,";"));for(var hashQuery=match[1].split(/,/),lastQuery={q:{filterInitiated:!1},filterQuery:this.controllerInstance.getFixedFilters()},iIndex=0;iIndex<hashQuery.length;iIndex++){var partMatch=hashQuery[iIndex].match(/^([a-z0-9]+)\[(.+)\]$/);if(null!=partMatch)if(hasMatches=!0,"q"==partMatch[1])lastQuery.q.searchQuery=decodeURIComponent(partMatch[2]);else{var filterId=partMatch[1].replace(/^f/,"");lastQuery.filterQuery[filterId]=partMatch[2].split(/;/);for(var p in lastQuery.filterQuery[filterId])if(p>=0){var value="";try{value=decodeURIComponent(lastQuery.filterQuery[filterId][p])}catch(err){value=lastQuery.filterQuery[filterId][p]}lastQuery.filterQuery[filterId][p]=value}}}}return hasMatches&&(this.controllerInstance.setSearchQuery(lastQuery.q.searchQuery),this.sendSearchQuery(lastQuery.q.searchQuery,lastQuery.filterQuery,lastQuery.q)),hasMatches}};