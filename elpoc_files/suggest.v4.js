"util"in websight||(!function(){var a="undefined"!=typeof window?window:exports,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=function(){try{document.createElement("$")}catch(a){return a}}();a.btoa||(a.btoa=function(a){for(var d,e,f=0,g=b,h="";a.charAt(0|f)||(g="=",f%1);h+=g.charAt(63&d>>8-f%1*8)){if(e=a.charCodeAt(f+=.75),e>255)throw c;d=d<<8|e}return h}),a.atob||(a.atob=function(a){if(a=a.replace(/=+$/,""),a.length%4==1)throw c;for(var e,f,d=0,g=0,h="";f=a.charAt(g++);~f&&(e=d%4?64*e+f:f,d++%4)?h+=String.fromCharCode(255&e>>(-2*d&6)):0)f=b.indexOf(f);return h})}(),websight.util={log:function(str){"undefined"!=typeof console&&console.log("[Sooqr] "+str)},ucFirst:function(str){return str.substring(0,1).toUpperCase()+str.substring(1)},getLanguage:function(){var language=window.navigator.userLanguage||window.navigator.language;return language.replace(/\-/g,"_")},getWindowScrollTop:function(){return Math.max($jQ("body").scrollTop(),$jQ("html").scrollTop())},setWindowScrollTop:function(top){return $jQ("body, html").scrollTop(top)},removeWww:function(hostname){return 0==hostname.indexOf("www.")&&(hostname=hostname.substring(4)),hostname},getCookie:function(key){for(var cookieContainer=document.cookie;(offset=cookieContainer.indexOf(key+"="))!=-1;){offset+=key.length+1;var end=document.cookie.indexOf(";",offset);end==-1&&(end=document.cookie.length);var cookie=document.cookie.substring(offset,end);return unescape(cookie)}return""},unsetCookie:function(key,value){var newCookie=key+"="+escape(value);newCookie+="; Path=/",newCookie+="; Domain=."+websight.util.removeWww(window.location.hostname),newCookie+="; Expires=Thu, 01 Jan 1970 00:00:01 GMT",document.cookie=newCookie},domainHash:function(){return this.createHash(window.location.hostname)},createHash:function(str){var iChar,charCode,hash=1,calc=0;if(str)for(hash=0,iChar=str.length-1;iChar>=0;iChar--)charCode=str.charCodeAt(iChar),hash=(hash<<6&268435455)+charCode+(charCode<<14),calc=266338304&hash,hash=0!=calc?hash^calc>>21:hash;return hash},propCount:function(obj){var counter=0;for(k in obj)obj.hasOwnProperty(k)&&counter++;return counter},replaceQueryVars:function(url,replace){var qparts={},index=0;if((index=url.indexOf("?"))!=-1){var params=url.substring(index+1).split(/&/);url=url.substring(0,index),$jQ.each(params,function(index,value){var keyValue=value.split(/=/);2==keyValue.length&&(qparts[keyValue[0]]=escape(keyValue[1]))})}for(k in replace)qparts[k]=replace[k];return url+="?",$jQ.each(qparts,function(index,value){url+=index+"="+value+"&"}),url},randomNumber:function(){return Math.round(2147483647*Math.random())},regexpEscape:function(text){if(!arguments.callee.sRE){var specials=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+specials.join("|\\")+")","g")}return text.replace(arguments.callee.sRE,"\\$1")},b64Encode:function(str){return btoa(str)},b64Decode:function(str){return atob(str)},_isTouch:null,isTouch:function(){return null==websight.util._isTouch&&("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?websight.util._isTouch=!0:websight.util._isTouch=!1),websight.util._isTouch},debounce:function(callback,delay){var timeout;return function(){var context=this,args=arguments;clearTimeout(timeout),timeout=setTimeout(function(){callback.apply(context,args)},delay)}}}),"DelayedQueue"in websight.util||(websight.util.DelayedQueue=function(instance,queue){for(this.instance=instance,this.push=function(element){var method=element.slice(0);return websight.util.log("test"),!!this.instance&&void this.instance[method].apply(this.instance,element)};element=queue.shift();)this.push(element)}),/*
 * jQuery Selectbox plugin 0.2
 *
 * Copyright 2011-2012, Dimitar Ivanov (http://www.bulgaria-web-developers.com/projects/javascript/selectbox/)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 * 
 * Date: Tue Jul 17 19:58:36 2012 +0300
 */
function($,undefined){function Selectbox(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}var PROP_NAME="selectbox",FALSE=!1,TRUE=!0;$.extend(Selectbox.prototype,{_isOpenSelectbox:function(target){if(!target)return FALSE;var inst=this._getInst(target);return inst.isOpen},_isDisabledSelectbox:function(target){if(!target)return FALSE;var inst=this._getInst(target);return inst.isDisabled},_attachSelectbox:function(target,settings){function closeOthers(){var key,sel,uid=this.attr("id").split("_")[1];for(key in self._state)key!==uid&&self._state.hasOwnProperty(key)&&(sel=$("select[sb='"+key+"']")[0],sel&&self._closeSelectbox(sel))}function getOptions(){var sub=!(!arguments[1]||!arguments[1].sub),disabled=!(!arguments[1]||!arguments[1].disabled);arguments[0].each(function(i){var child,that=$(this),li=$("<li>");that.is(":selected")&&(sbSelector.text(that.text()),s=TRUE),i===olen-1&&li.addClass("last"),that.is(":disabled")||disabled?(child=$("<span>",{text:that.text()}).addClass(inst.settings.classDisabled),sub&&child.addClass(inst.settings.classSub),child.appendTo(li)):(child=$("<a>",{href:"#"+that.val(),rel:that.val()}).text(that.text()).bind("click.sb",function(e){e&&e.preventDefault&&e.preventDefault();var t=sbToggle,$this=$(this);t.attr("id").split("_")[1];self._changeSelectbox(target,$this.attr("rel"),$this.text()),self._closeSelectbox(target)}).bind("mouseover.sb",function(){var $this=$(this);$this.parent().siblings().find("a").removeClass(inst.settings.classFocus),$this.addClass(inst.settings.classFocus)}).bind("mouseout.sb",function(){$(this).removeClass(inst.settings.classFocus)}),sub&&child.addClass(inst.settings.classSub),that.is(":selected")&&child.addClass(inst.settings.classFocus),child.appendTo(li)),li.appendTo(sbOptions)})}if(this._getInst(target))return FALSE;var sbHolder,sbSelector,sbToggle,sbOptions,$target=$(target),self=this,inst=self._newInst($target),s=FALSE,opts=($target.find("optgroup"),$target.find("option")),olen=opts.length;$target.attr("sb",inst.uid),$.extend(inst.settings,self._defaults,settings),self._state[inst.uid]=FALSE,$target.hide(),sbHolder=$("<div>",{id:"sbHolder_"+inst.uid,"class":inst.settings.classHolder,tabindex:$target.attr("tabindex")}),sbSelector=$("<a>",{id:"sbSelector_"+inst.uid,href:"#","class":inst.settings.classSelector,click:function(e){e.preventDefault(),closeOthers.apply($(this),[]);var uid=$(this).attr("id").split("_")[1];self._state[uid]?self._closeSelectbox(target):self._openSelectbox(target)}}),sbToggle=$("<a>",{id:"sbToggle_"+inst.uid,href:"#","class":inst.settings.classToggle,click:function(e){e.preventDefault(),closeOthers.apply($(this),[]);var uid=$(this).attr("id").split("_")[1];self._state[uid]?self._closeSelectbox(target):self._openSelectbox(target)}}),sbToggle.appendTo(sbHolder),sbOptions=$("<ul>",{id:"sbOptions_"+inst.uid,"class":inst.settings.classOptions,css:{display:"none"}}),$target.children().each(function(i){var li,that=$(this),config={};that.is("option")?getOptions(that):that.is("optgroup")&&(li=$("<li>"),$("<span>",{text:that.attr("label")}).addClass(inst.settings.classGroup).appendTo(li),li.appendTo(sbOptions),that.is(":disabled")&&(config.disabled=!0),config.sub=!0,getOptions(that.find("option"),config))}),s||sbSelector.text(opts.first().text()),$.data(target,PROP_NAME,inst),sbHolder.data("uid",inst.uid).bind("keydown.sb",function(e){var key=e.charCode?e.charCode:e.keyCode?e.keyCode:0,$this=$(this),uid=$this.data("uid"),inst=$this.siblings("select[sb='"+uid+"']").data(PROP_NAME),trgt=$this.siblings(["select[sb='",uid,"']"].join("")).get(0),$f=$this.find("ul").find("a."+inst.settings.classFocus);switch(key){case 37:case 38:if($f.length>0){var $next;$("a",$this).removeClass(inst.settings.classFocus),$next=$f.parent().prevAll("li:has(a)").eq(0).find("a"),$next.length>0&&($next.addClass(inst.settings.classFocus).focus(),$("#sbSelector_"+uid).text($next.text()))}break;case 39:case 40:var $next;$("a",$this).removeClass(inst.settings.classFocus),$next=$f.length>0?$f.parent().nextAll("li:has(a)").eq(0).find("a"):$this.find("ul").find("a").eq(0),$next.length>0&&($next.addClass(inst.settings.classFocus).focus(),$("#sbSelector_"+uid).text($next.text()));break;case 13:$f.length>0&&self._changeSelectbox(trgt,$f.attr("rel"),$f.text()),self._closeSelectbox(trgt);break;case 9:if(trgt){var inst=self._getInst(trgt);inst&&($f.length>0&&self._changeSelectbox(trgt,$f.attr("rel"),$f.text()),self._closeSelectbox(trgt))}var i=parseInt($this.attr("tabindex"),10);e.shiftKey?i--:i++,$("*[tabindex='"+i+"']").focus();break;case 27:self._closeSelectbox(trgt)}return e.stopPropagation(),!1}).delegate("a","mouseover",function(e){$(this).addClass(inst.settings.classFocus)}).delegate("a","mouseout",function(e){$(this).removeClass(inst.settings.classFocus)}),sbSelector.appendTo(sbHolder),sbOptions.appendTo(sbHolder),sbHolder.insertAfter($target),$("html").live("mousedown",function(e){e.stopPropagation(),$("select").selectbox("close")}),$([".",inst.settings.classHolder,", .",inst.settings.classSelector].join("")).mousedown(function(e){e.stopPropagation()})},_detachSelectbox:function(target){var inst=this._getInst(target);return inst?($("#sbHolder_"+inst.uid).remove(),$.data(target,PROP_NAME,null),void $(target).show()):FALSE},_changeSelectbox:function(target,value,text){var onChange,inst=this._getInst(target);inst&&(onChange=this._get(inst,"onChange"),$("#sbSelector_"+inst.uid).text(text)),value=value.replace(/\'/g,"\\'"),$(target).find("option[value='"+value+"']").attr("selected",TRUE),inst&&onChange?onChange.apply(inst.input?inst.input[0]:null,[value,inst]):inst&&inst.input&&inst.input.trigger("change")},_enableSelectbox:function(target){var inst=this._getInst(target);return inst&&inst.isDisabled?($("#sbHolder_"+inst.uid).removeClass(inst.settings.classHolderDisabled),inst.isDisabled=FALSE,void $.data(target,PROP_NAME,inst)):FALSE},_disableSelectbox:function(target){var inst=this._getInst(target);return!inst||inst.isDisabled?FALSE:($("#sbHolder_"+inst.uid).addClass(inst.settings.classHolderDisabled),inst.isDisabled=TRUE,void $.data(target,PROP_NAME,inst))},_optionSelectbox:function(target,name,value){var inst=this._getInst(target);return inst?(inst[name]=value,void $.data(target,PROP_NAME,inst)):FALSE},_openSelectbox:function(target){var inst=this._getInst(target);if(inst&&!inst.isOpen&&!inst.isDisabled){var el=$("#sbOptions_"+inst.uid),viewportHeight=parseInt($(window).height(),10),offset=$("#sbHolder_"+inst.uid).offset(),scrollTop=$(window).scrollTop(),height=el.prev().height(),diff=viewportHeight-(offset.top-scrollTop)-height/2,onOpen=this._get(inst,"onOpen");el.css({top:height+"px",maxHeight:diff-height+"px"}),"fade"===inst.settings.effect?el.fadeIn(inst.settings.speed):el.slideDown(inst.settings.speed),$("#sbToggle_"+inst.uid).addClass(inst.settings.classToggleOpen),this._state[inst.uid]=TRUE,inst.isOpen=TRUE,onOpen&&onOpen.apply(inst.input?inst.input[0]:null,[inst]),$.data(target,PROP_NAME,inst)}},_closeSelectbox:function(target){var inst=this._getInst(target);if(inst&&inst.isOpen){var onClose=this._get(inst,"onClose");"fade"===inst.settings.effect?$("#sbOptions_"+inst.uid).fadeOut(inst.settings.speed):$("#sbOptions_"+inst.uid).slideUp(inst.settings.speed),$("#sbToggle_"+inst.uid).removeClass(inst.settings.classToggleOpen),this._state[inst.uid]=FALSE,inst.isOpen=FALSE,onClose&&onClose.apply(inst.input?inst.input[0]:null,[inst]),$.data(target,PROP_NAME,inst)}},_newInst:function(target){var id=target[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:id,input:target,uid:Math.floor(99999999*Math.random()),isOpen:FALSE,isDisabled:FALSE,settings:{}}},_getInst:function(target){try{return $.data(target,PROP_NAME)}catch(err){throw"Missing instance data for this selectbox"}},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name]}}),$.fn.selectbox=function(options){var otherArgs=Array.prototype.slice.call(arguments,1);return"string"==typeof options&&"isDisabled"==options?$.selectbox["_"+options+"Selectbox"].apply($.selectbox,[this[0]].concat(otherArgs)):"option"==options&&2==arguments.length&&"string"==typeof arguments[1]?$.selectbox["_"+options+"Selectbox"].apply($.selectbox,[this[0]].concat(otherArgs)):this.each(function(){"string"==typeof options?$.selectbox["_"+options+"Selectbox"].apply($.selectbox,[this].concat(otherArgs)):$.selectbox._attachSelectbox(this,options)})},$.selectbox=new Selectbox,$.selectbox.version="0.2"}($jQ),window.websight=window.websight||{},window.websight.sooqr=window.websight.sooqr||{},window.websight.sooqr.Tracker=function(controllerInstance){this.controllerInstance=controllerInstance,this.index=null,this.view=null,this.account=null,this.cookiesUpdated=!1,this.version=3,this.cookieDomain="."+websight.util.removeWww(window.location.hostname),this.cookiePrefix="__sqr",this.paramPrefix="sqr",this.pixelPath=null,this.pixelFile=this.cookiePrefix+".gif",this.trackingArguments="",this.transactions=[],this.transactionItems=[],this.userLanguage="-",navigator.userLanguage?this.userLanguage=navigator.userLanguage:navigator.language&&(this.userLanguage=navigator.language),this.searchQuery="",this.queryTimeout=null,this.queryTimeoutMs=1e3,this.queryCallback=null,this.requestTime=Math.round((new Date).getTime()/1e3),this.visitorId=null,this.initialVisit=null,this.previousSession=null,this.currentSession=null,this.sessionCount=1,this.pageCount=0,this.callback=null,this.experimentId=null,this.setCookieA=function(){this.setCookie("a",[websight.util.domainHash(),this.getVisitorId(),this.initialVisit,this.previousSession,this.currentSession,this.sessionCount].join("."),63072e3)},this.setCookieB=function(){this.setCookie("b",[websight.util.domainHash(),this.pageCount,this.currentSession].join("."),1800)},this.setCookieC=function(){this.setCookie("c",websight.util.domainHash(),null)},this.getCookie=function(key){key=this.cookiePrefix+key;for(var cookieContainer=document.cookie;(offset=cookieContainer.indexOf(key+"="))!=-1;){offset+=key.length+1;var end=document.cookie.indexOf(";",offset);end==-1&&(end=document.cookie.length);var cookie=document.cookie.substring(offset,end);if(0==cookie.indexOf(websight.util.domainHash()+"."))return unescape(cookie);cookieContainer=cookieContainer.substring(offset+key.length+1)}return""},this.setCookie=function(key,data,expireSeconds){var newCookie=this.cookiePrefix+key+"="+escape(data);newCookie+="; Path=/",newCookie+="; Domain="+this.cookieDomain,void 0!=expireSeconds&&(newCookie+="; Max-Age="+expireSeconds),document.cookie=newCookie},this.updateCookies=function(){if(this.cookiesUpdated)return!0;this.cookiesUpdated=!0;var valCounter,parts;if(cookieA=this.getCookie("a")){for(parts=cookieA.split(/\./),valCounter=0;valCounter++,value=parts.shift();)if(value.length>0)switch(valCounter){case 2:this.visitorId=value;break;case 3:this.initialVisit=value;break;case 4:this.previousSession=value;break;case 5:this.currentSession=value;break;case 6:this.sessionCount=value}if(cookieB=this.getCookie("b")){for(parts=cookieB.split(/\./),valCounter=0;valCounter++,value=parts.shift();)if(value.length>0)switch(valCounter){case 2:this.pageCount=value;break;case 3:this.currentSession=value}}else this.previousSession=this.currentSession,this.currentSession=this.requestTime,this.sessionCount++}null==this.initialVisit&&(this.initialVisit=this.requestTime),null==this.previousSession&&(this.previousSession=this.requestTime),null==this.currentSession&&(this.currentSession=this.requestTime),this.pageCount++,this.setCookieA(),this.setCookieB(),this.setCookieC()},this.getVisitorId=function(){return null==this.visitorId&&(this.visitorId=this.randomNumber()),this.visitorId},this.randomNumber=function(){return Math.round(2147483647*Math.random())},this.getPixelArguments=function(extra){var val;extra=extra||{};var tmpArguments={t:null,vr:this.version,vw:this.view,ix:this.index,ac:this.account,rn:this.randomNumber(),ul:this.userLanguage,hn:escape(window.location.hostname),ri:null,rc:null,rt:null,ru:null,rid:null,qr:this.searchQuery?escape(this.searchQuery):null,qid:null,qix:null,qex:null,tid:null,ta:null,tr:null,ts:null,tt:null,tci:null,tst:null,tc:null,ic:null,"in":null,iv:null,ip:null,iq:null,cc:escape(this.cookiePrefix+"a="+this.getCookie("a")+";")},pixelArguments=new Array;for(k in tmpArguments)val=k in extra?extra[k]:tmpArguments[k],null!=val&&pixelArguments.push(this.paramPrefix+k+"="+val);return pixelArguments.join("&")},this.addPixel=function(args,callback){var pixel=new Image(1,1),serviceUrl="https:"==window.location.protocol?"https://static.sooqr.com":"http://static.sooqr.com";pixel.src=(this.pixelPath?this.pixelPath:serviceUrl+"/"+this.pixelFile)+"?"+this.getPixelArguments(args),pixel.onload=null!=callback?callback:this.callback},this._setIndex=function(index,view){this.index=index,this.view=view},this._setAccount=function(account){this.account=account},this._setLocalGifPath=function(path){this.pixelPath=path},this._setCallback=function(callback){this.callback=callback},this._trackQuery=function(query,resultCount,queryId,queryIndex){this.updateCookies(),this.index&&this.view&&(this.queryCallback=$jQ.proxy(function(){null!=this.queryTimeout&&(clearTimeout(this.queryTimeout),this.queryTimeout=null),this.queryCallback=null,this.addPixel({rc:resultCount,qr:query,qid:queryId,qix:queryIndex},null),$jQ(this.controllerInstance).trigger("trackQuery",[query,resultCount,queryId,queryIndex])},this),this.queryTimeoutMs>0?(null!=this.queryTimeout&&(clearTimeout(this.queryTimeout),this.queryTimeout=null),this.queryTimeout=setTimeout(this.queryCallback,this.queryTimeoutMs)):this.queryCallback())},this._trackFilter=function(query,resultCount,queryId,queryIndex,filterId,filterVal){this.updateCookies(),this.queryCallback&&this.queryCallback(),this.index&&this.view&&this.addPixel({t:"filter",rc:resultCount,qr:query,qid:queryId,qix:queryIndex},null)},this._trackResultClick=function(query,queryId,queryIndex,resultIndex,resultCount,resultId,resultTitle,resultUri,callback){if(this.updateCookies(),this.queryCallback&&this.queryCallback(),void 0==callback&&(callback=null),this.index&&this.view){var args={t:"click",qr:query,ri:resultIndex,rc:resultCount,rt:resultTitle,ru:resultUri,rid:resultId,qid:queryId,qix:queryIndex,qex:this.experimentId};this.addPixel(args,callback)}},this._addTrans=function(transactionId,affiliation,total,tax,shipping,city,state,country){this.index&&this.view&&(this.transactions[transactionId]={t:"transaction",tid:transactionId,ta:affiliation,tr:total,ts:shipping,tt:tax,tci:city,tst:state,tc:country})},this._addTransItem=function(transactionId,sku,name,category,price,quantity){this.index&&this.view&&(transactionId in this.transactions||websight.util.log("Invalid transactionId, please call _addTrans first."),this.transactionItems.push({t:"item",tid:transactionId,ic:sku,"in":name,iv:category,ip:price,iq:quantity}))},this._trackTrans=function(){this.updateCookies();for(transactionId in this.transactions){this.addPixel(this.transactions[transactionId]);for(var iItem=0;iItem<this.transactionItems.length;iItem++)transactionId==this.transactionItems[iItem].tid&&this.addPixel(this.transactionItems[iItem])}},this.setExperimentId=function(experimentId){this.experimentId=experimentId},"tracking"in this.controllerInstance&&1!=this.controllerInstance.tracking||this.updateCookies()},websight.sooqr.Suggest=function(parameters){if(this.objectName="Suggest",this.allowedToRun=!0,this.parameters=parameters,this.container=null,this.filterContainer=null,this.searchCallback=null,this.queryField=null,this.containerPosition="left",this.containerPositionParameter={left:0,top:0},this.overlay=null,this.initialized=!1,this.instanceName=null,this.tracking=!0,this.hideEmptyFilters=!1,this.placeholders=null,this.previousTypedQuery=null,this.responsiveResizeInitialized=!1,this.activeResponsiveWidth=null,this.trackerQueue=[],this.indexSettings={view:{selectQueryOnClick:!1}},this.indexSettingsOverrule={view:{}},(void 0==parameters.index||void 0==parameters.view)&&void 0==parameters.account)return websight.util.log("Account identifier missing. It should look like SQ-12345-1."),this.allowedToRun=!1,!1;if(parameters.zIndex=9999,parameters.index&&parameters.view)this.instanceName=parameters.index+"|"+parameters.view;else{if(!("account"in parameters&&parameters.account.match(/^SQ\-[0-9]+\-[0-9]+/)))return websight.util.log("Account identifier format is invalid. It should look like SQ-12345-1."),void(this.allowedToRun=!1);this.instanceName=parameters.account}if(websight.sooqr.instances[this.instanceName]=this,this.sourceCodeLoader=function(){parameters.source?new websight.sooqr.Loader.multiLoad(["/global/javascript/source/v"+this.parameters.version+"/jquery-ui.js","/global/javascript/source/v"+this.parameters.version+"/debug.js","/global/javascript/source/v"+this.parameters.version+"/searchCallback.js","/global/javascript/source/v"+this.parameters.version+"/filterPanel.js","/global/javascript/source/v"+this.parameters.version+"/resultsPanel.js"],$jQ.proxy(this.completeContainerInitialisation,this),(!1)):websight.sooqr.Loader.load(document.location.protocol+"//"+this.indexSettings.connection.staticServer+"/global/javascript/sooqr-core.v"+this.parameters.version+".js",$jQ.proxy(this.completeContainerInitialisation,this),!1)},this.completeInitialisation=function(){if($jQ.extend(!0,this.indexSettings,this.indexSettingsOverrule),0==this.indexSettings.active)return void(this.allowedToRun=!1);if(this.indexSettings.connection||(this.indexSettings.connection={}),this.indexSettings.index&&(this.parameters.index=this.indexSettings.index),this.indexSettings.account&&(this.parameters.account=this.indexSettings.account),this.indexSettings.view.id&&(this.parameters.view=this.indexSettings.view.id),websight.util.getCookie("sqrStaticServer").length>0?(this.indexSettings.connection.staticServer=websight.util.getCookie("sqrStaticServer"),websight.util.log("Using staticServer from cookie: "+this.indexSettings.connection.staticServer)):this.parameters.staticServer?this.indexSettings.connection.staticServer=this.parameters.staticServer:this.indexSettings.connection.staticServer="static.sooqr.com",websight.util.getCookie("sqrServer").length>0?(this.indexSettings.connection.server=websight.util.getCookie("sqrServer"),websight.util.log("Using server from cookie: "+this.indexSettings.connection.server)):this.parameters.server?this.indexSettings.connection.server=this.parameters.server:this.indexSettings.connection.server="dynamic.sooqr.com",this.parameters.proxy&&(this.indexSettings.connection.proxy=this.parameters.proxy),0!=this.allowedToRun){var customPath=this.parameters.account.replace(/^SQ\-/,"").replace(/\-/g,"/"),filename="combined.css";if(websight.util.getCookie("sooqr-preview-"+this.parameters.account.replace(/^SQ\-/,"")).length>0&&(filename="combined_preview.css"),$jQ.getCSS(document.location.protocol+"//"+this.indexSettings.connection.staticServer+"/custom/"+customPath+"/"+filename),$jQ.browser.msie&&($jQ.browser.version.match(/^7\./)?$jQ.getCSS(document.location.protocol+"//"+this.indexSettings.connection.staticServer+"/custom/"+customPath+"/extra-ie7.css"):$jQ.browser.version.match(/^8\./)&&$jQ.getCSS(document.location.protocol+"//"+this.indexSettings.connection.staticServer+"/custom/"+customPath+"/extra-ie8.css")),"filterContainer"in this.parameters){filterContainerName=this.parameters.filterContainer;var containers=$jQ(filterContainerName+" div.sooqrSearchFilters");if(null==containers||1!=containers.length)return websight.util.log("Suggest filter container not found"),this.allowedToRun=!1,!1;this.filterContainer=$jQ(filterContainerName).eq(0)}this.sourceCodeLoader()}},!this.initialized){this.initialized=!0;var serverName=websight.sooqr.Loader.hostname;parameters.server?serverName=parameters.server:parameters.debug&&(serverName="dynamic.sooqr.com.intern");var staticServerName;staticServerName=parameters.staticServer?parameters.staticServer:"static.sooqr.com",websight.sooqr.Loader.load(websight.sooqr.Loader.protocol+staticServerName+"/custom/"+parameters.account.substring(3).replace(/-/,"/")+".js",$jQ.proxy(this.completeInitialisation,this)),this.completeContainerInitialisation=function(){this.searchCallback=new websight.sooqr.SearchCallback(this),$jQ($jQ.proxy(function(){if(null==parameters.fieldId)this.queryField=null;else{var queryFields=$jQ("input#"+parameters.fieldId);if(null==queryFields||1!=queryFields.length)return websight.util.log("Query field not found"),!1;this.queryField=queryFields.first(),this.queryField.bind("focus",$jQ.proxy(function(){$jQ(this).trigger("focus")},this)),this.queryField.bind("blur",$jQ.proxy(function(){$jQ(this).trigger("blur")},this)),queryFields.attr("autocomplete","off")}if(null!=this.queryField&&this.indexSettings.view.disableFormSubmit)switch(this.indexSettings.view.disableFormSubmit){case"hide":$jQ('input[type="submit"], button[type="submit"]',this.queryField.closest("form")).hide();case"click":case"never":case"yes":var form=this.queryField.closest("form");form.unbind("submit").bind("submit",$jQ.proxy(function(event){return event.preventDefault(),event.stopPropagation(),this.searchCallback.directCallback({filterInitiated:!1}),!1},this))}if(null!=this.queryField){var keyUpFunction=$jQ.proxy(function(event){if(event.keyCode>=65||event.keyCode>=48&&event.keyCode<=57||8==event.keyCode||32==event.keyCode||46==event.keyCode||0==event.keyCode){var currentQuery=$jQ.trim(this.getSearchQuery());this.previousTypedQuery!=currentQuery&&this.searchCallback.delayedCallback({filterInitiated:!1}),this.previousTypedQuery=currentQuery}},this);this.queryField.bind("keyup",keyUpFunction);var clickFunction=$jQ.proxy(function(){!this.isContainerVisible()&&this.queryField.val()!=this.queryField.attr("title")&&this.checkNotPlaceholder(this.queryField.val())&&(this.queryField.val().length>0?this.searchCallback.delayedCallback({filterInitiated:!1}):this.previousTypedQuery="")},this);this.queryField.bind("click",clickFunction),"1"==this.indexSettings.view.selectQueryOnClick&&this.queryField.bind("focus",function(){this.select()})}this.container=$jQ("#sooqrView"+parameters.view);var enableMobileFilterIcons=void 0!==this.indexSettings.view.mobileFilterIcons&&this.indexSettings.view.mobileFilterIcons,containerHtml='<div class="sooqrSearchHeader" style="clear: both; display: none;"></div>'+(4==this.indexSettings.view.cssVersion?'<div class="sooqrSearchOptionsMobile"><div class="sqr-options"> </div><div class="sooqrSearchMobileTabs'+(enableMobileFilterIcons?" sooqrSearchMobileTabsIcons":"")+'"><div class="sooqrSearchMobileTabsResults sooqrSearchMobileTabsActive"><a><span id="sooqrSearchMobileTabsResultsText">Resultaten</span> (<span class="sqrSearchResultCounter"></span>)</a></div><div class="sooqrSearchMobileTabsFilters"><a id="sooqrSearchMobileTabsFiltersText">Filteren</a></div></div></div>':"")+'<div class="sooqrSearchFilters"></div><div class="sooqrSearchResultsContainer"><div class="sooqrSearchResults"></div></div><div class="sooqrSearchFooter" style="clear: both; display: none;"></div>';if(this.container.length?(this.container.html(containerHtml),this.container.hasClass("sooqrSearchContainer")||this.container.addClass("sooqrSearchContainer"),this.container.hasClass("sooqr-index-"+parameters.index.replace(/[^a-z0-9]/g,"-"))||this.container.addClass("sooqr-index-"+parameters.index.replace(/[^a-z0-9]/g,"-"))):(this.container=$jQ('<div class="sooqrSearchContainer sooqrSearchContainer-'+parameters.account.replace(/^SQ\-/,"")+" sooqr-index-"+parameters.index.replace(/[^a-z0-9]/g,"-")+'" id="sooqrView'+parameters.view+'">'+containerHtml+"</div>"),this.container.css("position","absolute").css("z-index",this.parameters.zIndex).hide(),"containerParent"in this.parameters?this.container.eq(0).appendTo($jQ(this.parameters.containerParent)):this.container.eq(0).appendTo(document.body)),this.positionContainer(),"enableBackButton"in this.indexSettings.view&&1==this.indexSettings.view.enableBackButton){var lastQuery=websight.util.getCookie("__sqrlq");if(void 0!=lastQuery&&"undefined"!=lastQuery||(lastQuery=null),null!=lastQuery&&lastQuery.length>0&&(lastQuery=$jQ.parseJSON(lastQuery)),null!=lastQuery&&""!=lastQuery&&"u"in lastQuery&&lastQuery.u==window.location.href&&"p"in lastQuery&&lastQuery.p.account==this.parameters.account)return websight.util.unsetCookie("__sqrlq"),websight.util.unsetCookie("__sqrlqc"),this.searchCallback.scrollAfterRequest=lastQuery.p.scrollAfterRequest,window.scrollTo(0,0),this.setSearchQuery(lastQuery.q.searchQuery),lastQuery.q.filterInitiated=!1,lastQuery.q.offset>0&&(lastQuery.q.limit=parseInt(lastQuery.q.offset)+this.indexSettings.view.resultsPerPage,lastQuery.q.offset=0),void this.searchCallback.sendSearchQuery(lastQuery.q.searchQuery,lastQuery.q.filterQuery,lastQuery.q);if(websight.util.getCookie("__sqrlqc").length>0)websight.util.unsetCookie("__sqrlqc"),websight.util.unsetCookie("__sqrlq");else if(websight.util.getCookie("__sqrlq")){var newCookie="__sqrlqc=1";newCookie+="; Path=/",newCookie+="; Domain=."+websight.util.removeWww(window.location.hostname),newCookie+="; Max-Age=300",document.cookie=newCookie}}if(this.trackerQueue=new websight.util.DelayedQueue(this.searchCallback.tracker,this.trackerQueue),null!=this.queryField){var fromHash=!1;("enableHash"in this.indexSettings.view&&1==this.indexSettings.view.enableHash||"enableLoadHash"in this.indexSettings.view&&1==this.indexSettings.view.enableLoadHash)&&(fromHash=this.searchCallback.parseSearchFromHash()),!fromHash&&this.queryField.val().length>0&&this.queryField.val()!=this.queryField.attr("title")&&this.checkNotPlaceholder(this.queryField.val())&&(this.previousTypedQuery=$jQ(this.queryField).val(),setTimeout($jQ.proxy(function(){this.searchCallback.directCallback({filterInitiated:!1})},this),250))}else this.searchCallback.directCallback({filterInitiated:!1})},this))},this.handleResponsiveResize=function(){this.responsiveResizeInitialized||($jQ(window).resize($jQ.proxy(function(){var $resultsContainer=this.getResultsContainer(),$optionsMobile=$jQ(".sooqrSearchOptionsMobile",this.container),$filtersContainer=$jQ(".sooqrSearchFilters",this.container),windowWidth=$jQ(window).width(),_activeResponsiveWidth=this.activeResponsiveWidth;if(windowWidth<this.indexSettings.view.responsiveMobileWidth){if(this.activeResponsiveWidth!=this.indexSettings.view.responsiveMobileWidth){var self=this;if($jQ(".sooqrSearchMobileTabsResults",$optionsMobile).hasClass("sooqrSearchMobileTabsActive")){$filtersContainer.hide(),$optionsMobile.data("original-top",$optionsMobile.offset().top)}var searchCallback=self.searchCallback,heightUpdateCallback=$jQ.proxy(function(){this.container.css("height",Math.max($jQ("body").height()-this.container.offset().top,this.searchCallback.filterPanel.getHeight()+$optionsMobile.height())+"px")},this);$jQ(".sooqrSearchMobileTabsFilters",$optionsMobile).bind("touchstart click",function(event){event.preventDefault(),event.stopPropagation(),$resultsContainer.hide(),$jQ(".sooqrSearchMobileTabsResults",$optionsMobile).removeClass("sooqrSearchMobileTabsActive"),$jQ(".sooqrSearchMobileTabsFilters",$optionsMobile).addClass("sooqrSearchMobileTabsActive"),$filtersContainer.show(),self.container.css("min-height",""),heightUpdateCallback(),$jQ(self).bind("updateFilters",heightUpdateCallback),searchCallback.resultsPanel.toggleMoreResultsLoaderCallback(!1),"fixed"==$optionsMobile.css("position")&&window.scrollTo(0,$optionsMobile.data("original-top"))}),$jQ(".sooqrSearchMobileTabsResults",$optionsMobile).bind("touchstart click",function(event){event.preventDefault(),event.stopPropagation(),$filtersContainer.hide(),$jQ(".sooqrSearchMobileTabsFilters",$optionsMobile).removeClass("sooqrSearchMobileTabsActive"),$jQ(".sooqrSearchMobileTabsResults",$optionsMobile).addClass("sooqrSearchMobileTabsActive"),$resultsContainer.show(),searchCallback.resultsPanel.toggleMoreResultsLoaderCallback(!0),$jQ(self).unbind("updateFilters",heightUpdateCallback),"fixed"==$optionsMobile.css("position")&&window.scrollTo(0,$optionsMobile.data("original-top"))}),this.moveChildren($resultsContainer.find(".sqr-options"),$optionsMobile.find(".sqr-options")),this.activeResponsiveWidth=this.indexSettings.view.responsiveMobileWidth}}else null!=this.activeResponsiveWidth&&($resultsContainer.show(),$filtersContainer.show(),this.container.css("height",""),this.moveChildren($optionsMobile.find(".sqr-options"),$resultsContainer.find(".sqr-options")),this.activeResponsiveWidth=null);this.searchCallback.filterPanel&&this.searchCallback.filterPanel.handleResponsiveResize(_activeResponsiveWidth,this.activeResponsiveWidth)},this)).resize(),this.responsiveResizeInitialized=!0)},this.moveChildren=function($src,$dest){var $children=$src.children(),$newContainer=$dest;$newContainer.empty();for(var iChild=0;iChild<$children.length;iChild++)$jQ($children[iChild]).detach().appendTo($newContainer)},this.setContainerPosition=function(position,parameter){this.containerPosition=position,void 0!=parameter?this.containerPositionParameter=parameter:this.containerPositionParameter=null},this.positionContainer=function(position,suppliedOffset,resize){if(void 0!=position&&null!=position||(position=this.containerPosition),void 0==resize&&(resize=!1),void 0!=suppliedOffset&&null!=suppliedOffset||(suppliedOffset=this.containerPositionParameter),null!=this.queryField){var inputOffset=this.queryField.offset();switch(inputOffset.top+=this.queryField.height()+14,position){case"left":inputOffset.left>$jQ(window).width()/2&&(inputOffset.left-=790-this.queryField.width());break;case"right":inputOffset.left=inputOffset.left-(this.container.width()-this.queryField.width())+7;break;case"screen-middle":inputOffset.left=Math.max(0,Math.floor($jQ(window).width()/2)-Math.floor(this.container.width()/2)),null!=suppliedOffset&&"top"in suppliedOffset&&(inputOffset.top+=$jQ.isFunction(suppliedOffset.top)?suppliedOffset.top():suppliedOffset.top),resize||$jQ(window).resize($jQ.proxy(function(){this.positionContainer(null,null,!0)},this));break;case"middle":inputOffset.left=inputOffset.left+Math.round(this.queryField.width()/2-this.container.width()/2);break;case"element-relative":if(null!=suppliedOffset){var element=$jQ(suppliedOffset);if(element){var elementOffset=element.offset();inputOffset.left=elementOffset.left,inputOffset.top=elementOffset.top,this.container.css("position","absolute")}}break;case"input-relative":inputOffset.left+=$jQ.isFunction(suppliedOffset.left)?suppliedOffset.left():suppliedOffset.left,inputOffset.top+=$jQ.isFunction(suppliedOffset.top)?suppliedOffset.top():suppliedOffset.top;break;case"fixed":inputOffset.left=$jQ.isFunction(suppliedOffset.left)?suppliedOffset.left():suppliedOffset.left,inputOffset.top=$jQ.isFunction(suppliedOffset.top)?suppliedOffset.top():suppliedOffset.top}this.container.css({"top":inputOffset.top+"px","left":inputOffset.left+"px"})}},this.showOverlays=function(){null==this.overlay&&(this.overlay=$jQ('<div id="sooqrOverlay">&#160;</div>'),$jQ(window.body).append(this.overlay)),this.overlay.show()},this.showContainer=function(){this.container.is(":visible")||("disable_auto_scroll_to_top"in this.indexSettings.view&&0!=this.indexSettings.view.disable_auto_scroll_to_top||window.scrollTo(0,0),this.indexSettings.view.contentSectionSelector&&$jQ(this.indexSettings.view.contentSectionSelector).css("visibility","hidden"),this.positionContainer(),this.updateMinimumHeight(),this.showOverlays(),this.container.show(),$jQ(this).trigger("open"))},this.hideContainer=function(){this.container.hide(),this.hideOverlay(),this.previousTypedQuery=null,this.indexSettings.view.contentSectionSelector&&$jQ(this.indexSettings.view.contentSectionSelector).css("visibility","visible"),
"clearQueryfieldOnClose"in this.indexSettings.view&&this.indexSettings.view.clearQueryfieldOnClose&&this.queryField.val(""),"enableHash"in this.indexSettings.view&&1==this.indexSettings.view.enableHash&&this.searchCallback.serializeSearchToHash({}),void 0!=this.searchCallback.filterPanel&&null!=this.searchCallback.filterPanel&&(this.searchCallback.filterPanel.persistentParameters={filtersShowAll:!1,filterValuesShowAll:{}}),"scrollToTopOnClose"in this.indexSettings.view&&this.indexSettings.view.scrollToTopOnClose&&window.scrollTo(0,0),$jQ(this).trigger("close")},this.isContainerVisible=function(){return this.container.is(":visible")},this.hideOverlay=function(){null!=this.overlay&&this.overlay.hide()},this.getContainer=function(){return this.container},this.getFilterContainer=function(){return this.filterContainer||this.container},this.getParameters=function(){return this.parameters},this.checkIfAnalyticsLoaded=function(){return window.gat_&&window.gat_.getTracker_?2:!!window.urchinTracker&&1},this.getQueryText=function(){return null!=this.queryField?this.queryField.val():""},this.setQueryText=function(text){this.setSearchQuery(text),this.checkNotPlaceholder(text)&&this.searchCallback.directCallback({filterInitiated:!1})},this.getResultsContainer=function(){return $jQ("div.sooqrSearchResultsContainer",this.container)},this.getSearchQuery=function(){return null!=this.queryField?this.queryField.val():null},this.setSearchQuery=function(text){return null!=this.queryField?this.queryField.val(text):null},this.getApiMethod=function(){return"suggest"},this.push=function(element){var method=element.shift();switch(method){case"_disableTracking":this.tracking=!1;break;case"_enableTracking":this.tracking=!0;break;case"_addTrans":this.trackerQueue.push(["_addTrans",element.shift(),element.shift(),element.shift(),element.shift(),element.shift(),element.shift(),element.shift(),element.shift()]);break;case"_addTransItem":this.trackerQueue.push(["_addTransItem",element.shift(),element.shift(),element.shift(),element.shift(),element.shift(),element.shift()]);break;case"_trackTrans":this.trackerQueue.push(["_trackTrans"]);break;case"_hideEmptyFilters":this.hideEmptyFilters=element.shift();break;case"_setProxy":this.parameters.proxy=element.shift();break;case"_setDefaultFilters":this.parameters.defaultFilters=element.shift();break;case"_excludePlaceholders":this.placeholders=element.shift();break;case"_setSecuredFilters":this.parameters.securedFiltersHash=element.shift(),this.parameters.securedFilters=element.shift();break;case"_setZIndex":this.parameters.zIndex=element.shift();break;case"_refreshPosition":this.positionContainer();break;case"_close":this.hideContainer();break;case"_setPosition":var position=element.shift();"fixed"==position||"input-relative"==position||"element-relative"==position||"screen-middle"==position?this.setContainerPosition(position,element.shift()):this.setContainerPosition(position);break;case"_setDynamicFields":this.parameters.dynamicFields=element.shift();break;default:return!1}return!0},this.appendDefaultFilters=function(filterQuery){if(this.parameters.defaultFilters){null==filterQuery&&(filterQuery={});for(k in this.parameters.defaultFilters)this.parameters.defaultFilters.hasOwnProperty(k)&&!filterQuery.hasOwnProperty(k)&&(filterQuery[k]=this.parameters.defaultFilters[k])}if(this.parameters.defaultSubValues)for(filterId in this.parameters.defaultSubValues)if(filterQuery[filterId])for(k in this.parameters.defaultSubValues[filterId])filterQuery[filterId]._&&filterQuery[filterId]._==k&&!filterQuery[filterId].values&&(filterQuery[filterId].values=this.parameters.defaultSubValues[filterId][k]);return filterQuery},this.appendFixedFilters=function(filterQuery){if(this.parameters.fixedFilters){null==filterQuery&&(filterQuery={});for(k in this.parameters.fixedFilters)this.parameters.fixedFilters.hasOwnProperty(k)&&!filterQuery.hasOwnProperty(k)&&(filterQuery[k]=this.parameters.fixedFilters[k])}return filterQuery},this.getFixedFilters=function(){return this.parameters&&"fixedFilters"in this.parameters?this.parameters.fixedFilters:{}},this.appendSecuredFilters=function(filterQuery){if(null==filterQuery&&(filterQuery={}),this.parameters.securedFilters){null==filterQuery&&(filterQuery={});for(k in this.parameters.securedFilters)this.parameters.securedFilters.hasOwnProperty(k)&&(filterQuery[k]=this.parameters.securedFilters[k])}return filterQuery},this.needResultsRender=function(){return!0},this.resetFilters=function(event){event.preventDefault(),this.searchCallback.filterPanel.panelElement.find('a[rel="reset"]').css("visibility","hidden"),this.searchCallback.directCallback({filterInitiated:!1})},this.checkNotPlaceholder=function(query){return null==this.placeholders||$jQ.isArray(this.placeholders)&&$jQ.inArray(query,this.placeholders)==-1||!$jQ.isArray(this.placeholders)&&query!=this.placeholders},this.appendSecuredFiltersParameters=function(queryParameters){return this.parameters.securedFilters&&(queryParameters.securedFiltersHash=this.parameters.securedFiltersHash),queryParameters},this.appendDynamicFieldsParameters=function(queryParameters){return this.parameters.dynamicFields&&(queryParameters.dynamicFields=this.parameters.dynamicFields),queryParameters},this.updateMinimumHeight=function(){if("container"in this){var minimumHeight=0;minimumHeight="containerParent"in this.parameters?$jQ(window).height():$jQ("html, body").height(),null!=this.resultsPanel&&(minimumHeight=Math.max(this.resultsPanel.getContainerHeight(),minimumHeight)),null!=this.filterPanel&&(minimumHeight=Math.max(this.filterPanel.getHeight(),minimumHeight));var containerOffset=this.container.offset();this.container.css("min-height",Math.round(minimumHeight-containerOffset.top)+"px")}},this.handleClick=function(event,url){window.location.href=this.searchCallback.createAnalyticsUrl(url)},$jQ(this).bind("click",$jQ.proxy(this.handleClick,this))}};